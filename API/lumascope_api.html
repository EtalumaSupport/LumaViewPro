<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.1"/>
    <title>lumascope_api API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Lumascope">Lumascope</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Lumascope.__init__">Lumascope</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.leds_enable">leds_enable</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.leds_disable">leds_disable</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.led_on">led_on</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.led_off">led_off</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.leds_off">leds_off</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.ch2color">ch2color</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.color2ch">color2ch</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_image">get_image</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.save_image">save_image</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_max_width">get_max_width</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_max_height">get_max_height</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_width">get_width</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_height">get_height</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.set_frame_size">set_frame_size</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.set_gain">set_gain</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.set_auto_gain">set_auto_gain</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.set_exposure_time">set_exposure_time</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_exposure_time">get_exposure_time</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.set_auto_exposure_time">set_auto_exposure_time</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.zhome">zhome</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.xyhome">xyhome</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.xycenter">xycenter</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.thome">thome</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_target_position">get_target_position</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_current_position">get_current_position</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.move_absolute_position">move_absolute_position</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.move_relative_position">move_relative_position</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_home_status">get_home_status</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_target_status">get_target_status</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_reference_status">get_reference_status</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.get_overshoot">get_overshoot</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.autofocus">autofocus</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.focus_function">focus_function</a>
                        </li>
                        <li>
                                <a class="function" href="#Lumascope.focus_best">focus_best</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
lumascope_api    </h1>

                        <div class="docstring"><p>MIT License</p>

<p>Copyright (c) 2023 Etaluma, Inc.</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyribackground_downght notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>

<pre><code>
</code></pre>

<p>This open source software was developed for use with Etaluma microscopes.</p>

<p>AUTHORS:
Kevin Peter Hickerson, The Earthineering Company
Anna Iwaniec Hickerson, Keck Graduate Institute</p>

<p>MODIFIED:
March 16, 2023</p>
</div>

                        <input id="mod-lumascope_api-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-lumascope_api-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#!/usr/bin/python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">MIT License</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">Copyright (c) 2023 Etaluma, Inc.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">in the Software without restriction, including without limitation the rights</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">furnished to do so, subject to the following conditions:</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">The above copyribackground_downght notice and this permission notice shall be included in all</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">copies or substantial portions of the Software.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">SOFTWARE.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">```</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">```</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">This open source software was developed for use with Etaluma microscopes.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">AUTHORS:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">Kevin Peter Hickerson, The Earthineering Company</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">Anna Iwaniec Hickerson, Keck Graduate Institute</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">MODIFIED:</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">March 16, 2023</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="c1"># Import Lumascope Hardware files</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="kn">from</span> <span class="nn">motorboard</span> <span class="kn">import</span> <span class="n">MotorBoard</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="kn">from</span> <span class="nn">ledboard</span> <span class="kn">import</span> <span class="n">LEDBoard</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="kn">from</span> <span class="nn">pyloncamera</span> <span class="kn">import</span> <span class="n">PylonCamera</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="kn">import</span> <span class="nn">cv2</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="k">class</span> <span class="nc">Lumascope</span><span class="p">():</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Microscope&quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="c1"># LED Control Board</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">led</span> <span class="o">=</span> <span class="n">LEDBoard</span><span class="p">()</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] LED Board Not Initialized&#39;</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="c1"># Motion Control Board</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion</span> <span class="o">=</span> <span class="n">MotorBoard</span><span class="p">()</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Motion Board Not Initialized&#39;</span><span class="p">)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="c1"># Camera</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">PylonCamera</span><span class="p">()</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Camera Board Not Initialized&#39;</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="c1">########################################################################</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="c1"># LED BOARD FUNCTIONS</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="c1">########################################################################</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">leds_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        Enable all LEDS&quot;&quot;&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_enable</span><span class="p">()</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">leds_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        Disable all LEDS&quot;&quot;&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_disable</span><span class="p">()</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">led_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">mA</span><span class="p">):</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        Turn on LED at channel number at mA power &quot;&quot;&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">led_on</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">mA</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="nf">led_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        Turn off LED at channel number &quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">led_off</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">leds_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        Turn off all LEDs &quot;&quot;&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_off</span><span class="p">()</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">ch2color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        Convert channel number to string representing color</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">         0 -&gt; Blue: Fluorescence</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">         1 -&gt; Green: Fluorescence</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">         2 -&gt; Red: Fluorescence</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">         3 -&gt; BF: Brightfield</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">         4 -&gt; PC: Phase Contrast</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">         5 -&gt; DF: Low Mag Darkfield</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">           &quot;&quot;&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">ch2color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">color2ch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        Convert string representing color to channel number</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">         Blue: Fluorescence Channel 0   -&gt; 0</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">         Green: Fluorescence Channel 1  -&gt; 1</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">         Red: Fluorescence Channel 2    -&gt; 2</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">         BF: Brightfield                -&gt; 3</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">         PC: Phase Contrast             -&gt; 4</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">         DF: Low Mag Darkfield          -&gt; 5</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">           &quot;&quot;&quot;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">color2ch</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="c1">########################################################################</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="c1"># CAMERA FUNCTIONS</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="c1">########################################################################</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; CAMERA FUNCTIONS</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        Grab and return image from camera&quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">grab</span><span class="p">():</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="k">return</span> <span class="n">array</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">save_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_folder</span> <span class="o">=</span> <span class="s1">&#39;./capture&#39;</span><span class="p">,</span> <span class="n">file_root</span> <span class="o">=</span> <span class="s1">&#39;img_&#39;</span><span class="p">,</span> <span class="n">append</span> <span class="o">=</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;BF&#39;</span><span class="p">):</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        Grab the current live image and save to file</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>            <span class="k">return</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="k">return</span> 
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Blue&#39;</span><span class="p">:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Green&#39;</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Red&#39;</span><span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="c1"># set filename options</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="n">append</span> <span class="o">==</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)))</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="k">elif</span> <span class="n">append</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="c1"># generate filename string</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">file_root</span> <span class="o">+</span> <span class="n">append</span> <span class="o">+</span> <span class="s1">&#39;.tiff&#39;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">filename</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[SCOPE API ] Saving Image to&quot;</span><span class="p">,</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">filename</span> <span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[SCOPE API ] Error: Unable to save. Perhaps save folder does not exist?&quot;</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">get_max_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        Grab the max pixel width of camera</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Width</span><span class="o">.</span><span class="n">Max</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">get_max_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        Grab the max pixel height of camera</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">Max</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>      
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">get_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        Grab the current pixel width setting of camera</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Width</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">get_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        Grab the current pixel height setting of camera</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="k">def</span> <span class="nf">set_frame_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        Set frame size (pixel width by picel height</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        of camera to w by h&quot;&quot;&quot;</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">frame_size</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>    <span class="k">def</span> <span class="nf">set_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gain</span><span class="p">):</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        Set camera gain&quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">gain</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    <span class="k">def</span> <span class="nf">set_auto_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        Enable / Disable camera auto_gain with the value of &#39;state&#39;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        It will be continueously updating based on the current image &quot;&quot;&quot;</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">auto_gain</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    <span class="k">def</span> <span class="nf">set_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">         Set exposure time in the camera hardware t (msec)&quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">exposure_t</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="k">def</span> <span class="nf">get_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">         Get exposure time in the camera hardware</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">         Returns t (msec), or -1 if the camera is inactive&quot;&quot;&quot;</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="n">exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_exposure_t</span><span class="p">()</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="n">exposure</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="k">def</span> <span class="nf">set_auto_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">         Enable / Disable camera auto_exposure with the value of &#39;state&#39;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        It will be continueously updating based on the current image &quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">auto_exposure_t</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>    <span class="c1">########################################################################</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>    <span class="c1"># MOTION CONTROL FUNCTIONS</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>    <span class="c1">########################################################################</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>    <span class="k">def</span> <span class="nf">zhome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">        Home the z-axis (i.e. focus)&quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">zhome</span><span class="p">()</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>    <span class="k">def</span> <span class="nf">xyhome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        Home the xy-axes (i.e. stage). Note: z-axis and turret will always home first&quot;&quot;&quot;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">xyhome</span><span class="p">()</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">xycenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        Move Stage to the center.&quot;&quot;&quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">xycenter</span><span class="p">()</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>    <span class="k">def</span> <span class="nf">thome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        Home the Turret&quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">thome</span><span class="p">()</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">get_target_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        Get the value of the target position of the axis relative to home</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        Returns position (um), or 0 if the motion board is inactive</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">        values of axis &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, and &#39;T&#39; &quot;&quot;&quot;</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="n">target_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">target_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">return</span> <span class="n">target_position</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">get_current_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        Get the value of the current position of the axis relative to home</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        Returns position (um), or 0 if the motion board is inactive</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        values of axis &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, and &#39;T&#39; &quot;&quot;&quot;</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="n">target_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">current_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">return</span> <span class="n">target_position</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>    <span class="k">def</span> <span class="nf">move_absolute_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">         Move to absolute position (in um) of axis&quot;&quot;&quot;</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">move_abs_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">move_relative_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">um</span><span class="p">):</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">         Move to relative distance (in um) of axis&quot;&quot;&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">move_rel_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">um</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="nf">get_home_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">         Return True if axis is in home position&quot;&quot;&quot;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a> 
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">home_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="n">status</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    <span class="k">def</span> <span class="nf">get_target_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">         Return True if axis is at target position&quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">target_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="k">return</span> <span class="n">status</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>    <span class="c1"># Get all reference status register bits as 32 character string (32-&gt; 0)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>    <span class="k">def</span> <span class="nf">get_reference_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">         Get all reference status register bits as 32 character string (32-&gt; 0) &quot;&quot;&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">reference_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="k">return</span> <span class="n">status</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>    <span class="k">def</span> <span class="nf">get_overshoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">        Is z-axis (focus) currently in overshoot mode?&quot;&quot;&quot;</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">overshoot</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    <span class="c1">########################################################################</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="c1"># INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>    <span class="c1">########################################################################</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="c1">## IN PROGRESS - DO NOT USE ##</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        begin autofocus functionality (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="c1"># These should be passed but its not working</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="n">AF_range</span> <span class="o">=</span> <span class="mf">15.0</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="n">AF_min</span> <span class="o">=</span>   <span class="mf">0.5</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="n">AF_max</span> <span class="o">=</span>   <span class="mf">6.0</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Lumascope.autofocus()&#39;</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_complete</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Error: VerticalControl.autofocus()&#39;</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="k">return</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span><span class="o">-</span><span class="n">AF_range</span><span class="p">)</span>      <span class="c1"># starting minimum z-height for autofocus</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">center</span><span class="o">+</span><span class="n">AF_range</span>              <span class="c1"># starting maximum z-height for autofocus</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">AF_max</span>                  <span class="c1"># starting step size for autofocus</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exposure_time</span><span class="p">()</span>  <span class="c1"># camera exposure to determine &#39;wait&#39; time</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># List of positions to step through</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Measure focus score at each position</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_focus</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># Last / Previous focus score</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">False</span>         <span class="c1"># Are we on the last scan for autofocus?</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="c1"># Start the autofocus process at z-minimum</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span><span class="p">:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="c1"># If the z-height has reached its target</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_status</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_overshoot</span><span class="p">():</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                <span class="c1"># Wait two exposure lengths</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exposure</span><span class="o">/</span><span class="mi">1000</span><span class="o">+</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># msec into sec</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                <span class="c1"># observe the image </span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>                <span class="c1"># Use center quarter of image for focusing</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rows</span><span class="o">/</span><span class="mi">4</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">rows</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">cols</span><span class="o">/</span><span class="mi">4</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cols</span><span class="o">/</span><span class="mi">4</span><span class="p">)]</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>                <span class="c1"># calculate the position and focus measure</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>                    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                    <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_function</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>                    <span class="n">next_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Error talking to motion controller.&#39;</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                    <span class="k">raise</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                <span class="c1"># append to positions and focus measures</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">focus</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="c1"># if (focus &lt; self.last_focus) or (next_target &gt; self.z_max):</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                <span class="k">if</span> <span class="n">next_target</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                    <span class="c1"># Calculate new step size for resolution</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                    <span class="n">prev_resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">prev_resolution</span> <span class="o">/</span> <span class="mi">3</span> <span class="c1"># SELECT DESIRED RESOLUTION FRACTION</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">&lt;</span> <span class="n">AF_min</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">AF_min</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>                    <span class="c1"># As long as the step size is larger than or equal to the minimum and not the last pass</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">&gt;=</span> <span class="n">AF_min</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>                        <span class="c1"># compute best focus</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>                        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>                        <span class="c1"># assign new z_min, z_max, resolution, and sweep</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="n">focus</span><span class="o">-</span><span class="n">prev_resolution</span> 
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">focus</span><span class="o">+</span><span class="n">prev_resolution</span> 
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>                        <span class="c1"># reset positions and focus measures</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>                        <span class="c1"># go to new z_min</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">==</span> <span class="n">AF_min</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.last = True&#39;</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>                    <span class="k">else</span><span class="p">:</span> <span class="c1"># self.resolution &gt;= AF_min and not self.last</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>                        <span class="c1"># compute best focus</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>                        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>                        
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>                        <span class="c1"># go to best focus</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="c1"># move to absolute target</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>                        
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                        <span class="c1"># end autofocus sequence</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                        
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">is_complete</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>                    <span class="c1"># move to next position</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">move_relative_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                <span class="c1"># update last focus</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_focus</span> <span class="o">=</span> <span class="n">focus</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="c1"># Algorithms for estimating the quality of the focus</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="k">def</span> <span class="nf">focus_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s1">&#39;vollath4&#39;</span><span class="p">):</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        assess focus value at specific position for autofocus function</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] VerticalControl.focus_function()&#39;</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="c1"># Journal of Microscopy, Vol. 188, Pt 3, December 1997, pp. 264–272</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;vollath4&#39;</span><span class="p">:</span> <span class="c1"># pg 266</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>            <span class="n">sum_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">image</span><span class="p">[:</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="n">h</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">w</span><span class="p">,:</span><span class="n">h</span><span class="p">]))</span> <span class="c1"># g(i, j).g(i+1, j)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="n">sum_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">image</span><span class="p">[:</span><span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">,:</span><span class="n">h</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">w</span><span class="p">,:</span><span class="n">h</span><span class="p">]))</span> <span class="c1"># g(i, j).g(i+2, j)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Vollath: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sum_one</span> <span class="o">-</span> <span class="n">sum_two</span><span class="p">))</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="k">return</span> <span class="n">sum_one</span> <span class="o">-</span> <span class="n">sum_two</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;skew&#39;</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>            <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">))</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>            <span class="n">white_edge</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>            <span class="n">skew</span> <span class="o">=</span> <span class="n">white_edge</span><span class="o">-</span><span class="n">max_index</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Skew: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">skew</span><span class="p">))</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="k">return</span> <span class="n">skew</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;pixel_variation&#39;</span><span class="p">:</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="nb">sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>            <span class="n">ssq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="n">var</span> <span class="o">=</span> <span class="n">ssq</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="nb">sum</span><span class="o">**</span><span class="mi">2</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Pixel Variation: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="k">return</span> <span class="n">var</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="w">        </span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">        elif algorithm == &#39;convolve2D&#39;:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">            # Bueno-Ibarra et al. Optical Engineering 44(6), 063601 (June 2005)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">            kernel = np.array([ [0, -1, 0],</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">                                [-1, 4,-1],</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">                                [0, -1, 0]], dtype=&#39;float&#39;) / 6</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">            n = 9</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">            a = 1</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">            kernel = np.zeros([n,n])</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">            for i in range(n):</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">                for j in range(n):</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">                    r2 = ((i-(n-1)/2)**2 + (j-(n-1)/2)**2)/a**2</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">                    kernel[i,j] = 2*(1-r2)*np.exp(-0.5*r2)/np.sqrt(3*a)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">            print(&#39;[LVP Main  ] kernel\t&#39; + str(kernel))</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">            convolve = signal.convolve2d(image, kernel, mode=&#39;valid&#39;)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">            sum = np.sum(convolve)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">            print(&#39;[LVP Main  ] sum\t&#39; + str(sum))</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">            return sum</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>    <span class="k">def</span> <span class="nf">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">):</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">        select best focus position for autofocus function</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">        (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] VerticalControl.focus_best()&#39;</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;direct&#39;</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>            <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;mov_avg&#39;</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>            <span class="n">avg_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">avg_values</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="Lumascope">
                            <input id="Lumascope-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Lumascope</span>:

                <label class="view-source-button" for="Lumascope-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope-47"><a href="#Lumascope-47"><span class="linenos"> 47</span></a><span class="k">class</span> <span class="nc">Lumascope</span><span class="p">():</span>
</span><span id="Lumascope-48"><a href="#Lumascope-48"><span class="linenos"> 48</span></a>
</span><span id="Lumascope-49"><a href="#Lumascope-49"><span class="linenos"> 49</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-50"><a href="#Lumascope-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Microscope&quot;&quot;&quot;</span>
</span><span id="Lumascope-51"><a href="#Lumascope-51"><span class="linenos"> 51</span></a>
</span><span id="Lumascope-52"><a href="#Lumascope-52"><span class="linenos"> 52</span></a>        <span class="c1"># LED Control Board</span>
</span><span id="Lumascope-53"><a href="#Lumascope-53"><span class="linenos"> 53</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope-54"><a href="#Lumascope-54"><span class="linenos"> 54</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">led</span> <span class="o">=</span> <span class="n">LEDBoard</span><span class="p">()</span>
</span><span id="Lumascope-55"><a href="#Lumascope-55"><span class="linenos"> 55</span></a>
</span><span id="Lumascope-56"><a href="#Lumascope-56"><span class="linenos"> 56</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope-57"><a href="#Lumascope-57"><span class="linenos"> 57</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] LED Board Not Initialized&#39;</span><span class="p">)</span>
</span><span id="Lumascope-58"><a href="#Lumascope-58"><span class="linenos"> 58</span></a>        
</span><span id="Lumascope-59"><a href="#Lumascope-59"><span class="linenos"> 59</span></a>        <span class="c1"># Motion Control Board</span>
</span><span id="Lumascope-60"><a href="#Lumascope-60"><span class="linenos"> 60</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope-61"><a href="#Lumascope-61"><span class="linenos"> 61</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion</span> <span class="o">=</span> <span class="n">MotorBoard</span><span class="p">()</span>
</span><span id="Lumascope-62"><a href="#Lumascope-62"><span class="linenos"> 62</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope-63"><a href="#Lumascope-63"><span class="linenos"> 63</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Motion Board Not Initialized&#39;</span><span class="p">)</span>
</span><span id="Lumascope-64"><a href="#Lumascope-64"><span class="linenos"> 64</span></a>
</span><span id="Lumascope-65"><a href="#Lumascope-65"><span class="linenos"> 65</span></a>        <span class="c1"># Camera</span>
</span><span id="Lumascope-66"><a href="#Lumascope-66"><span class="linenos"> 66</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope-67"><a href="#Lumascope-67"><span class="linenos"> 67</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">PylonCamera</span><span class="p">()</span>
</span><span id="Lumascope-68"><a href="#Lumascope-68"><span class="linenos"> 68</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope-69"><a href="#Lumascope-69"><span class="linenos"> 69</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Camera Board Not Initialized&#39;</span><span class="p">)</span>
</span><span id="Lumascope-70"><a href="#Lumascope-70"><span class="linenos"> 70</span></a>
</span><span id="Lumascope-71"><a href="#Lumascope-71"><span class="linenos"> 71</span></a>
</span><span id="Lumascope-72"><a href="#Lumascope-72"><span class="linenos"> 72</span></a>    <span class="c1">########################################################################</span>
</span><span id="Lumascope-73"><a href="#Lumascope-73"><span class="linenos"> 73</span></a>    <span class="c1"># LED BOARD FUNCTIONS</span>
</span><span id="Lumascope-74"><a href="#Lumascope-74"><span class="linenos"> 74</span></a>    <span class="c1">########################################################################</span>
</span><span id="Lumascope-75"><a href="#Lumascope-75"><span class="linenos"> 75</span></a>
</span><span id="Lumascope-76"><a href="#Lumascope-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">leds_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-77"><a href="#Lumascope-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope-78"><a href="#Lumascope-78"><span class="linenos"> 78</span></a><span class="sd">        Enable all LEDS&quot;&quot;&quot;</span>
</span><span id="Lumascope-79"><a href="#Lumascope-79"><span class="linenos"> 79</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-80"><a href="#Lumascope-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_enable</span><span class="p">()</span>
</span><span id="Lumascope-81"><a href="#Lumascope-81"><span class="linenos"> 81</span></a>
</span><span id="Lumascope-82"><a href="#Lumascope-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="nf">leds_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-83"><a href="#Lumascope-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope-84"><a href="#Lumascope-84"><span class="linenos"> 84</span></a><span class="sd">        Disable all LEDS&quot;&quot;&quot;</span>
</span><span id="Lumascope-85"><a href="#Lumascope-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-86"><a href="#Lumascope-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_disable</span><span class="p">()</span>
</span><span id="Lumascope-87"><a href="#Lumascope-87"><span class="linenos"> 87</span></a>
</span><span id="Lumascope-88"><a href="#Lumascope-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">led_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">mA</span><span class="p">):</span>
</span><span id="Lumascope-89"><a href="#Lumascope-89"><span class="linenos"> 89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope-90"><a href="#Lumascope-90"><span class="linenos"> 90</span></a><span class="sd">        Turn on LED at channel number at mA power &quot;&quot;&quot;</span>
</span><span id="Lumascope-91"><a href="#Lumascope-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-92"><a href="#Lumascope-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">led_on</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">mA</span><span class="p">)</span>
</span><span id="Lumascope-93"><a href="#Lumascope-93"><span class="linenos"> 93</span></a>
</span><span id="Lumascope-94"><a href="#Lumascope-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">led_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
</span><span id="Lumascope-95"><a href="#Lumascope-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope-96"><a href="#Lumascope-96"><span class="linenos"> 96</span></a><span class="sd">        Turn off LED at channel number &quot;&quot;&quot;</span>
</span><span id="Lumascope-97"><a href="#Lumascope-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-98"><a href="#Lumascope-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">led_off</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</span><span id="Lumascope-99"><a href="#Lumascope-99"><span class="linenos"> 99</span></a>
</span><span id="Lumascope-100"><a href="#Lumascope-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">leds_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-101"><a href="#Lumascope-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope-102"><a href="#Lumascope-102"><span class="linenos">102</span></a><span class="sd">        Turn off all LEDs &quot;&quot;&quot;</span>
</span><span id="Lumascope-103"><a href="#Lumascope-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-104"><a href="#Lumascope-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_off</span><span class="p">()</span>
</span><span id="Lumascope-105"><a href="#Lumascope-105"><span class="linenos">105</span></a>
</span><span id="Lumascope-106"><a href="#Lumascope-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">ch2color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="Lumascope-107"><a href="#Lumascope-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope-108"><a href="#Lumascope-108"><span class="linenos">108</span></a><span class="sd">        Convert channel number to string representing color</span>
</span><span id="Lumascope-109"><a href="#Lumascope-109"><span class="linenos">109</span></a><span class="sd">         0 -&gt; Blue: Fluorescence</span>
</span><span id="Lumascope-110"><a href="#Lumascope-110"><span class="linenos">110</span></a><span class="sd">         1 -&gt; Green: Fluorescence</span>
</span><span id="Lumascope-111"><a href="#Lumascope-111"><span class="linenos">111</span></a><span class="sd">         2 -&gt; Red: Fluorescence</span>
</span><span id="Lumascope-112"><a href="#Lumascope-112"><span class="linenos">112</span></a><span class="sd">         3 -&gt; BF: Brightfield</span>
</span><span id="Lumascope-113"><a href="#Lumascope-113"><span class="linenos">113</span></a><span class="sd">         4 -&gt; PC: Phase Contrast</span>
</span><span id="Lumascope-114"><a href="#Lumascope-114"><span class="linenos">114</span></a><span class="sd">         5 -&gt; DF: Low Mag Darkfield</span>
</span><span id="Lumascope-115"><a href="#Lumascope-115"><span class="linenos">115</span></a><span class="sd">           &quot;&quot;&quot;</span>
</span><span id="Lumascope-116"><a href="#Lumascope-116"><span class="linenos">116</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-117"><a href="#Lumascope-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">ch2color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</span><span id="Lumascope-118"><a href="#Lumascope-118"><span class="linenos">118</span></a>
</span><span id="Lumascope-119"><a href="#Lumascope-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">color2ch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="Lumascope-120"><a href="#Lumascope-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope-121"><a href="#Lumascope-121"><span class="linenos">121</span></a><span class="sd">        Convert string representing color to channel number</span>
</span><span id="Lumascope-122"><a href="#Lumascope-122"><span class="linenos">122</span></a><span class="sd">         Blue: Fluorescence Channel 0   -&gt; 0</span>
</span><span id="Lumascope-123"><a href="#Lumascope-123"><span class="linenos">123</span></a><span class="sd">         Green: Fluorescence Channel 1  -&gt; 1</span>
</span><span id="Lumascope-124"><a href="#Lumascope-124"><span class="linenos">124</span></a><span class="sd">         Red: Fluorescence Channel 2    -&gt; 2</span>
</span><span id="Lumascope-125"><a href="#Lumascope-125"><span class="linenos">125</span></a><span class="sd">         BF: Brightfield                -&gt; 3</span>
</span><span id="Lumascope-126"><a href="#Lumascope-126"><span class="linenos">126</span></a><span class="sd">         PC: Phase Contrast             -&gt; 4</span>
</span><span id="Lumascope-127"><a href="#Lumascope-127"><span class="linenos">127</span></a><span class="sd">         DF: Low Mag Darkfield          -&gt; 5</span>
</span><span id="Lumascope-128"><a href="#Lumascope-128"><span class="linenos">128</span></a><span class="sd">           &quot;&quot;&quot;</span>
</span><span id="Lumascope-129"><a href="#Lumascope-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-130"><a href="#Lumascope-130"><span class="linenos">130</span></a>        
</span><span id="Lumascope-131"><a href="#Lumascope-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">color2ch</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</span><span id="Lumascope-132"><a href="#Lumascope-132"><span class="linenos">132</span></a>
</span><span id="Lumascope-133"><a href="#Lumascope-133"><span class="linenos">133</span></a>    <span class="c1">########################################################################</span>
</span><span id="Lumascope-134"><a href="#Lumascope-134"><span class="linenos">134</span></a>    <span class="c1"># CAMERA FUNCTIONS</span>
</span><span id="Lumascope-135"><a href="#Lumascope-135"><span class="linenos">135</span></a>    <span class="c1">########################################################################</span>
</span><span id="Lumascope-136"><a href="#Lumascope-136"><span class="linenos">136</span></a>
</span><span id="Lumascope-137"><a href="#Lumascope-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-138"><a href="#Lumascope-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; CAMERA FUNCTIONS</span>
</span><span id="Lumascope-139"><a href="#Lumascope-139"><span class="linenos">139</span></a><span class="sd">        Grab and return image from camera&quot;&quot;&quot;</span>
</span><span id="Lumascope-140"><a href="#Lumascope-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">grab</span><span class="p">():</span>
</span><span id="Lumascope-141"><a href="#Lumascope-141"><span class="linenos">141</span></a>            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">array</span>
</span><span id="Lumascope-142"><a href="#Lumascope-142"><span class="linenos">142</span></a>            <span class="k">return</span> <span class="n">array</span>
</span><span id="Lumascope-143"><a href="#Lumascope-143"><span class="linenos">143</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope-144"><a href="#Lumascope-144"><span class="linenos">144</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope-145"><a href="#Lumascope-145"><span class="linenos">145</span></a>
</span><span id="Lumascope-146"><a href="#Lumascope-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">save_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_folder</span> <span class="o">=</span> <span class="s1">&#39;./capture&#39;</span><span class="p">,</span> <span class="n">file_root</span> <span class="o">=</span> <span class="s1">&#39;img_&#39;</span><span class="p">,</span> <span class="n">append</span> <span class="o">=</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;BF&#39;</span><span class="p">):</span>
</span><span id="Lumascope-147"><a href="#Lumascope-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-148"><a href="#Lumascope-148"><span class="linenos">148</span></a><span class="sd">        Grab the current live image and save to file</span>
</span><span id="Lumascope-149"><a href="#Lumascope-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope-150"><a href="#Lumascope-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
</span><span id="Lumascope-151"><a href="#Lumascope-151"><span class="linenos">151</span></a>            <span class="k">return</span>
</span><span id="Lumascope-152"><a href="#Lumascope-152"><span class="linenos">152</span></a>        
</span><span id="Lumascope-153"><a href="#Lumascope-153"><span class="linenos">153</span></a>        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="Lumascope-154"><a href="#Lumascope-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="Lumascope-155"><a href="#Lumascope-155"><span class="linenos">155</span></a>            <span class="k">return</span> 
</span><span id="Lumascope-156"><a href="#Lumascope-156"><span class="linenos">156</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Lumascope-157"><a href="#Lumascope-157"><span class="linenos">157</span></a>
</span><span id="Lumascope-158"><a href="#Lumascope-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Blue&#39;</span><span class="p">:</span>
</span><span id="Lumascope-159"><a href="#Lumascope-159"><span class="linenos">159</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope-160"><a href="#Lumascope-160"><span class="linenos">160</span></a>        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Green&#39;</span><span class="p">:</span>
</span><span id="Lumascope-161"><a href="#Lumascope-161"><span class="linenos">161</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope-162"><a href="#Lumascope-162"><span class="linenos">162</span></a>        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Red&#39;</span><span class="p">:</span>
</span><span id="Lumascope-163"><a href="#Lumascope-163"><span class="linenos">163</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope-164"><a href="#Lumascope-164"><span class="linenos">164</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope-165"><a href="#Lumascope-165"><span class="linenos">165</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope-166"><a href="#Lumascope-166"><span class="linenos">166</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope-167"><a href="#Lumascope-167"><span class="linenos">167</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope-168"><a href="#Lumascope-168"><span class="linenos">168</span></a>
</span><span id="Lumascope-169"><a href="#Lumascope-169"><span class="linenos">169</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Lumascope-170"><a href="#Lumascope-170"><span class="linenos">170</span></a>
</span><span id="Lumascope-171"><a href="#Lumascope-171"><span class="linenos">171</span></a>        <span class="c1"># set filename options</span>
</span><span id="Lumascope-172"><a href="#Lumascope-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">append</span> <span class="o">==</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span>
</span><span id="Lumascope-173"><a href="#Lumascope-173"><span class="linenos">173</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)))</span>
</span><span id="Lumascope-174"><a href="#Lumascope-174"><span class="linenos">174</span></a>        <span class="k">elif</span> <span class="n">append</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
</span><span id="Lumascope-175"><a href="#Lumascope-175"><span class="linenos">175</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
</span><span id="Lumascope-176"><a href="#Lumascope-176"><span class="linenos">176</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope-177"><a href="#Lumascope-177"><span class="linenos">177</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Lumascope-178"><a href="#Lumascope-178"><span class="linenos">178</span></a>
</span><span id="Lumascope-179"><a href="#Lumascope-179"><span class="linenos">179</span></a>        <span class="c1"># generate filename string</span>
</span><span id="Lumascope-180"><a href="#Lumascope-180"><span class="linenos">180</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">file_root</span> <span class="o">+</span> <span class="n">append</span> <span class="o">+</span> <span class="s1">&#39;.tiff&#39;</span>
</span><span id="Lumascope-181"><a href="#Lumascope-181"><span class="linenos">181</span></a>
</span><span id="Lumascope-182"><a href="#Lumascope-182"><span class="linenos">182</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope-183"><a href="#Lumascope-183"><span class="linenos">183</span></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">filename</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
</span><span id="Lumascope-184"><a href="#Lumascope-184"><span class="linenos">184</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[SCOPE API ] Saving Image to&quot;</span><span class="p">,</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">filename</span> <span class="p">)</span>
</span><span id="Lumascope-185"><a href="#Lumascope-185"><span class="linenos">185</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope-186"><a href="#Lumascope-186"><span class="linenos">186</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[SCOPE API ] Error: Unable to save. Perhaps save folder does not exist?&quot;</span><span class="p">)</span>
</span><span id="Lumascope-187"><a href="#Lumascope-187"><span class="linenos">187</span></a>
</span><span id="Lumascope-188"><a href="#Lumascope-188"><span class="linenos">188</span></a>    <span class="k">def</span> <span class="nf">get_max_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-189"><a href="#Lumascope-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-190"><a href="#Lumascope-190"><span class="linenos">190</span></a><span class="sd">        Grab the max pixel width of camera</span>
</span><span id="Lumascope-191"><a href="#Lumascope-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope-192"><a href="#Lumascope-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope-193"><a href="#Lumascope-193"><span class="linenos">193</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Width</span><span class="o">.</span><span class="n">Max</span>
</span><span id="Lumascope-194"><a href="#Lumascope-194"><span class="linenos">194</span></a>
</span><span id="Lumascope-195"><a href="#Lumascope-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">get_max_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-196"><a href="#Lumascope-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-197"><a href="#Lumascope-197"><span class="linenos">197</span></a><span class="sd">        Grab the max pixel height of camera</span>
</span><span id="Lumascope-198"><a href="#Lumascope-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope-199"><a href="#Lumascope-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope-200"><a href="#Lumascope-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">Max</span>
</span><span id="Lumascope-201"><a href="#Lumascope-201"><span class="linenos">201</span></a>      
</span><span id="Lumascope-202"><a href="#Lumascope-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">get_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-203"><a href="#Lumascope-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-204"><a href="#Lumascope-204"><span class="linenos">204</span></a><span class="sd">        Grab the current pixel width setting of camera</span>
</span><span id="Lumascope-205"><a href="#Lumascope-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope-206"><a href="#Lumascope-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope-207"><a href="#Lumascope-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Width</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
</span><span id="Lumascope-208"><a href="#Lumascope-208"><span class="linenos">208</span></a>
</span><span id="Lumascope-209"><a href="#Lumascope-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">get_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-210"><a href="#Lumascope-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-211"><a href="#Lumascope-211"><span class="linenos">211</span></a><span class="sd">        Grab the current pixel height setting of camera</span>
</span><span id="Lumascope-212"><a href="#Lumascope-212"><span class="linenos">212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope-213"><a href="#Lumascope-213"><span class="linenos">213</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope-214"><a href="#Lumascope-214"><span class="linenos">214</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
</span><span id="Lumascope-215"><a href="#Lumascope-215"><span class="linenos">215</span></a>
</span><span id="Lumascope-216"><a href="#Lumascope-216"><span class="linenos">216</span></a>    <span class="k">def</span> <span class="nf">set_frame_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
</span><span id="Lumascope-217"><a href="#Lumascope-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-218"><a href="#Lumascope-218"><span class="linenos">218</span></a><span class="sd">        Set frame size (pixel width by picel height</span>
</span><span id="Lumascope-219"><a href="#Lumascope-219"><span class="linenos">219</span></a><span class="sd">        of camera to w by h&quot;&quot;&quot;</span>
</span><span id="Lumascope-220"><a href="#Lumascope-220"><span class="linenos">220</span></a>
</span><span id="Lumascope-221"><a href="#Lumascope-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-222"><a href="#Lumascope-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">frame_size</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span><span id="Lumascope-223"><a href="#Lumascope-223"><span class="linenos">223</span></a>
</span><span id="Lumascope-224"><a href="#Lumascope-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="nf">set_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gain</span><span class="p">):</span>
</span><span id="Lumascope-225"><a href="#Lumascope-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-226"><a href="#Lumascope-226"><span class="linenos">226</span></a><span class="sd">        Set camera gain&quot;&quot;&quot;</span>
</span><span id="Lumascope-227"><a href="#Lumascope-227"><span class="linenos">227</span></a>
</span><span id="Lumascope-228"><a href="#Lumascope-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-229"><a href="#Lumascope-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">gain</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span>
</span><span id="Lumascope-230"><a href="#Lumascope-230"><span class="linenos">230</span></a>
</span><span id="Lumascope-231"><a href="#Lumascope-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">set_auto_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Lumascope-232"><a href="#Lumascope-232"><span class="linenos">232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-233"><a href="#Lumascope-233"><span class="linenos">233</span></a><span class="sd">        Enable / Disable camera auto_gain with the value of &#39;state&#39;</span>
</span><span id="Lumascope-234"><a href="#Lumascope-234"><span class="linenos">234</span></a><span class="sd">        It will be continueously updating based on the current image &quot;&quot;&quot;</span>
</span><span id="Lumascope-235"><a href="#Lumascope-235"><span class="linenos">235</span></a>
</span><span id="Lumascope-236"><a href="#Lumascope-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-237"><a href="#Lumascope-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">auto_gain</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="Lumascope-238"><a href="#Lumascope-238"><span class="linenos">238</span></a>
</span><span id="Lumascope-239"><a href="#Lumascope-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">set_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="Lumascope-240"><a href="#Lumascope-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-241"><a href="#Lumascope-241"><span class="linenos">241</span></a><span class="sd">         Set exposure time in the camera hardware t (msec)&quot;&quot;&quot;</span>
</span><span id="Lumascope-242"><a href="#Lumascope-242"><span class="linenos">242</span></a>
</span><span id="Lumascope-243"><a href="#Lumascope-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-244"><a href="#Lumascope-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">exposure_t</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Lumascope-245"><a href="#Lumascope-245"><span class="linenos">245</span></a>
</span><span id="Lumascope-246"><a href="#Lumascope-246"><span class="linenos">246</span></a>    <span class="k">def</span> <span class="nf">get_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-247"><a href="#Lumascope-247"><span class="linenos">247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-248"><a href="#Lumascope-248"><span class="linenos">248</span></a><span class="sd">         Get exposure time in the camera hardware</span>
</span><span id="Lumascope-249"><a href="#Lumascope-249"><span class="linenos">249</span></a><span class="sd">         Returns t (msec), or -1 if the camera is inactive&quot;&quot;&quot;</span>
</span><span id="Lumascope-250"><a href="#Lumascope-250"><span class="linenos">250</span></a>
</span><span id="Lumascope-251"><a href="#Lumascope-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Lumascope-252"><a href="#Lumascope-252"><span class="linenos">252</span></a>        <span class="n">exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_exposure_t</span><span class="p">()</span>
</span><span id="Lumascope-253"><a href="#Lumascope-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="n">exposure</span>
</span><span id="Lumascope-254"><a href="#Lumascope-254"><span class="linenos">254</span></a>        
</span><span id="Lumascope-255"><a href="#Lumascope-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">set_auto_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="Lumascope-256"><a href="#Lumascope-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope-257"><a href="#Lumascope-257"><span class="linenos">257</span></a><span class="sd">         Enable / Disable camera auto_exposure with the value of &#39;state&#39;</span>
</span><span id="Lumascope-258"><a href="#Lumascope-258"><span class="linenos">258</span></a><span class="sd">        It will be continueously updating based on the current image &quot;&quot;&quot;</span>
</span><span id="Lumascope-259"><a href="#Lumascope-259"><span class="linenos">259</span></a>
</span><span id="Lumascope-260"><a href="#Lumascope-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-261"><a href="#Lumascope-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">auto_exposure_t</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="Lumascope-262"><a href="#Lumascope-262"><span class="linenos">262</span></a>
</span><span id="Lumascope-263"><a href="#Lumascope-263"><span class="linenos">263</span></a>    <span class="c1">########################################################################</span>
</span><span id="Lumascope-264"><a href="#Lumascope-264"><span class="linenos">264</span></a>    <span class="c1"># MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-265"><a href="#Lumascope-265"><span class="linenos">265</span></a>    <span class="c1">########################################################################</span>
</span><span id="Lumascope-266"><a href="#Lumascope-266"><span class="linenos">266</span></a>
</span><span id="Lumascope-267"><a href="#Lumascope-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">zhome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-268"><a href="#Lumascope-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-269"><a href="#Lumascope-269"><span class="linenos">269</span></a><span class="sd">        Home the z-axis (i.e. focus)&quot;&quot;&quot;</span>
</span><span id="Lumascope-270"><a href="#Lumascope-270"><span class="linenos">270</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-271"><a href="#Lumascope-271"><span class="linenos">271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">zhome</span><span class="p">()</span>
</span><span id="Lumascope-272"><a href="#Lumascope-272"><span class="linenos">272</span></a>
</span><span id="Lumascope-273"><a href="#Lumascope-273"><span class="linenos">273</span></a>    <span class="k">def</span> <span class="nf">xyhome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-274"><a href="#Lumascope-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-275"><a href="#Lumascope-275"><span class="linenos">275</span></a><span class="sd">        Home the xy-axes (i.e. stage). Note: z-axis and turret will always home first&quot;&quot;&quot;</span>
</span><span id="Lumascope-276"><a href="#Lumascope-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-277"><a href="#Lumascope-277"><span class="linenos">277</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">xyhome</span><span class="p">()</span>
</span><span id="Lumascope-278"><a href="#Lumascope-278"><span class="linenos">278</span></a>
</span><span id="Lumascope-279"><a href="#Lumascope-279"><span class="linenos">279</span></a>    <span class="k">def</span> <span class="nf">xycenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-280"><a href="#Lumascope-280"><span class="linenos">280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-281"><a href="#Lumascope-281"><span class="linenos">281</span></a><span class="sd">        Move Stage to the center.&quot;&quot;&quot;</span>
</span><span id="Lumascope-282"><a href="#Lumascope-282"><span class="linenos">282</span></a>
</span><span id="Lumascope-283"><a href="#Lumascope-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-284"><a href="#Lumascope-284"><span class="linenos">284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">xycenter</span><span class="p">()</span>
</span><span id="Lumascope-285"><a href="#Lumascope-285"><span class="linenos">285</span></a>
</span><span id="Lumascope-286"><a href="#Lumascope-286"><span class="linenos">286</span></a>    <span class="k">def</span> <span class="nf">thome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-287"><a href="#Lumascope-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-288"><a href="#Lumascope-288"><span class="linenos">288</span></a><span class="sd">        Home the Turret&quot;&quot;&quot;</span>
</span><span id="Lumascope-289"><a href="#Lumascope-289"><span class="linenos">289</span></a>
</span><span id="Lumascope-290"><a href="#Lumascope-290"><span class="linenos">290</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-291"><a href="#Lumascope-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">thome</span><span class="p">()</span>
</span><span id="Lumascope-292"><a href="#Lumascope-292"><span class="linenos">292</span></a>
</span><span id="Lumascope-293"><a href="#Lumascope-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">get_target_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope-294"><a href="#Lumascope-294"><span class="linenos">294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-295"><a href="#Lumascope-295"><span class="linenos">295</span></a><span class="sd">        Get the value of the target position of the axis relative to home</span>
</span><span id="Lumascope-296"><a href="#Lumascope-296"><span class="linenos">296</span></a><span class="sd">        Returns position (um), or 0 if the motion board is inactive</span>
</span><span id="Lumascope-297"><a href="#Lumascope-297"><span class="linenos">297</span></a><span class="sd">        values of axis &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, and &#39;T&#39; &quot;&quot;&quot;</span>
</span><span id="Lumascope-298"><a href="#Lumascope-298"><span class="linenos">298</span></a>
</span><span id="Lumascope-299"><a href="#Lumascope-299"><span class="linenos">299</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope-300"><a href="#Lumascope-300"><span class="linenos">300</span></a>        <span class="n">target_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">target_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope-301"><a href="#Lumascope-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="n">target_position</span>
</span><span id="Lumascope-302"><a href="#Lumascope-302"><span class="linenos">302</span></a>        
</span><span id="Lumascope-303"><a href="#Lumascope-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">get_current_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope-304"><a href="#Lumascope-304"><span class="linenos">304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-305"><a href="#Lumascope-305"><span class="linenos">305</span></a><span class="sd">        Get the value of the current position of the axis relative to home</span>
</span><span id="Lumascope-306"><a href="#Lumascope-306"><span class="linenos">306</span></a><span class="sd">        Returns position (um), or 0 if the motion board is inactive</span>
</span><span id="Lumascope-307"><a href="#Lumascope-307"><span class="linenos">307</span></a><span class="sd">        values of axis &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, and &#39;T&#39; &quot;&quot;&quot;</span>
</span><span id="Lumascope-308"><a href="#Lumascope-308"><span class="linenos">308</span></a>
</span><span id="Lumascope-309"><a href="#Lumascope-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope-310"><a href="#Lumascope-310"><span class="linenos">310</span></a>        <span class="n">target_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">current_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope-311"><a href="#Lumascope-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="n">target_position</span>
</span><span id="Lumascope-312"><a href="#Lumascope-312"><span class="linenos">312</span></a>        
</span><span id="Lumascope-313"><a href="#Lumascope-313"><span class="linenos">313</span></a>    <span class="k">def</span> <span class="nf">move_absolute_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
</span><span id="Lumascope-314"><a href="#Lumascope-314"><span class="linenos">314</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-315"><a href="#Lumascope-315"><span class="linenos">315</span></a><span class="sd">         Move to absolute position (in um) of axis&quot;&quot;&quot;</span>
</span><span id="Lumascope-316"><a href="#Lumascope-316"><span class="linenos">316</span></a>
</span><span id="Lumascope-317"><a href="#Lumascope-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-318"><a href="#Lumascope-318"><span class="linenos">318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">move_abs_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="Lumascope-319"><a href="#Lumascope-319"><span class="linenos">319</span></a>
</span><span id="Lumascope-320"><a href="#Lumascope-320"><span class="linenos">320</span></a>    <span class="k">def</span> <span class="nf">move_relative_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">um</span><span class="p">):</span>
</span><span id="Lumascope-321"><a href="#Lumascope-321"><span class="linenos">321</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-322"><a href="#Lumascope-322"><span class="linenos">322</span></a><span class="sd">         Move to relative distance (in um) of axis&quot;&quot;&quot;</span>
</span><span id="Lumascope-323"><a href="#Lumascope-323"><span class="linenos">323</span></a>
</span><span id="Lumascope-324"><a href="#Lumascope-324"><span class="linenos">324</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope-325"><a href="#Lumascope-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">move_rel_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">um</span><span class="p">)</span>
</span><span id="Lumascope-326"><a href="#Lumascope-326"><span class="linenos">326</span></a>
</span><span id="Lumascope-327"><a href="#Lumascope-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">get_home_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope-328"><a href="#Lumascope-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-329"><a href="#Lumascope-329"><span class="linenos">329</span></a><span class="sd">         Return True if axis is in home position&quot;&quot;&quot;</span>
</span><span id="Lumascope-330"><a href="#Lumascope-330"><span class="linenos">330</span></a> 
</span><span id="Lumascope-331"><a href="#Lumascope-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope-332"><a href="#Lumascope-332"><span class="linenos">332</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">home_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope-333"><a href="#Lumascope-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="n">status</span>
</span><span id="Lumascope-334"><a href="#Lumascope-334"><span class="linenos">334</span></a>
</span><span id="Lumascope-335"><a href="#Lumascope-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="nf">get_target_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope-336"><a href="#Lumascope-336"><span class="linenos">336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-337"><a href="#Lumascope-337"><span class="linenos">337</span></a><span class="sd">         Return True if axis is at target position&quot;&quot;&quot;</span>
</span><span id="Lumascope-338"><a href="#Lumascope-338"><span class="linenos">338</span></a>
</span><span id="Lumascope-339"><a href="#Lumascope-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope-340"><a href="#Lumascope-340"><span class="linenos">340</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">target_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope-341"><a href="#Lumascope-341"><span class="linenos">341</span></a>        <span class="k">return</span> <span class="n">status</span>
</span><span id="Lumascope-342"><a href="#Lumascope-342"><span class="linenos">342</span></a>        
</span><span id="Lumascope-343"><a href="#Lumascope-343"><span class="linenos">343</span></a>    <span class="c1"># Get all reference status register bits as 32 character string (32-&gt; 0)</span>
</span><span id="Lumascope-344"><a href="#Lumascope-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">get_reference_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope-345"><a href="#Lumascope-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-346"><a href="#Lumascope-346"><span class="linenos">346</span></a><span class="sd">         Get all reference status register bits as 32 character string (32-&gt; 0) &quot;&quot;&quot;</span>
</span><span id="Lumascope-347"><a href="#Lumascope-347"><span class="linenos">347</span></a>
</span><span id="Lumascope-348"><a href="#Lumascope-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope-349"><a href="#Lumascope-349"><span class="linenos">349</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">reference_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope-350"><a href="#Lumascope-350"><span class="linenos">350</span></a>        <span class="k">return</span> <span class="n">status</span>
</span><span id="Lumascope-351"><a href="#Lumascope-351"><span class="linenos">351</span></a>
</span><span id="Lumascope-352"><a href="#Lumascope-352"><span class="linenos">352</span></a>    <span class="k">def</span> <span class="nf">get_overshoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope-353"><a href="#Lumascope-353"><span class="linenos">353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope-354"><a href="#Lumascope-354"><span class="linenos">354</span></a><span class="sd">        Is z-axis (focus) currently in overshoot mode?&quot;&quot;&quot;</span>
</span><span id="Lumascope-355"><a href="#Lumascope-355"><span class="linenos">355</span></a>
</span><span id="Lumascope-356"><a href="#Lumascope-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope-357"><a href="#Lumascope-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">overshoot</span>
</span><span id="Lumascope-358"><a href="#Lumascope-358"><span class="linenos">358</span></a>
</span><span id="Lumascope-359"><a href="#Lumascope-359"><span class="linenos">359</span></a>    <span class="c1">########################################################################</span>
</span><span id="Lumascope-360"><a href="#Lumascope-360"><span class="linenos">360</span></a>    <span class="c1"># INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="Lumascope-361"><a href="#Lumascope-361"><span class="linenos">361</span></a>    <span class="c1">########################################################################</span>
</span><span id="Lumascope-362"><a href="#Lumascope-362"><span class="linenos">362</span></a>
</span><span id="Lumascope-363"><a href="#Lumascope-363"><span class="linenos">363</span></a>    <span class="c1">## IN PROGRESS - DO NOT USE ##</span>
</span><span id="Lumascope-364"><a href="#Lumascope-364"><span class="linenos">364</span></a>    <span class="k">def</span> <span class="nf">autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="Lumascope-365"><a href="#Lumascope-365"><span class="linenos">365</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="Lumascope-366"><a href="#Lumascope-366"><span class="linenos">366</span></a><span class="sd">        begin autofocus functionality (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="Lumascope-367"><a href="#Lumascope-367"><span class="linenos">367</span></a>        
</span><span id="Lumascope-368"><a href="#Lumascope-368"><span class="linenos">368</span></a>        <span class="c1"># These should be passed but its not working</span>
</span><span id="Lumascope-369"><a href="#Lumascope-369"><span class="linenos">369</span></a>        <span class="n">AF_range</span> <span class="o">=</span> <span class="mf">15.0</span>
</span><span id="Lumascope-370"><a href="#Lumascope-370"><span class="linenos">370</span></a>        <span class="n">AF_min</span> <span class="o">=</span>   <span class="mf">0.5</span>
</span><span id="Lumascope-371"><a href="#Lumascope-371"><span class="linenos">371</span></a>        <span class="n">AF_max</span> <span class="o">=</span>   <span class="mf">6.0</span>
</span><span id="Lumascope-372"><a href="#Lumascope-372"><span class="linenos">372</span></a>        
</span><span id="Lumascope-373"><a href="#Lumascope-373"><span class="linenos">373</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Lumascope.autofocus()&#39;</span><span class="p">)</span>
</span><span id="Lumascope-374"><a href="#Lumascope-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_complete</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Lumascope-375"><a href="#Lumascope-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Lumascope-376"><a href="#Lumascope-376"><span class="linenos">376</span></a>
</span><span id="Lumascope-377"><a href="#Lumascope-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="Lumascope-378"><a href="#Lumascope-378"><span class="linenos">378</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Error: VerticalControl.autofocus()&#39;</span><span class="p">)</span>
</span><span id="Lumascope-379"><a href="#Lumascope-379"><span class="linenos">379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Lumascope-380"><a href="#Lumascope-380"><span class="linenos">380</span></a>            <span class="k">return</span>
</span><span id="Lumascope-381"><a href="#Lumascope-381"><span class="linenos">381</span></a>
</span><span id="Lumascope-382"><a href="#Lumascope-382"><span class="linenos">382</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
</span><span id="Lumascope-383"><a href="#Lumascope-383"><span class="linenos">383</span></a>
</span><span id="Lumascope-384"><a href="#Lumascope-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span><span class="o">-</span><span class="n">AF_range</span><span class="p">)</span>      <span class="c1"># starting minimum z-height for autofocus</span>
</span><span id="Lumascope-385"><a href="#Lumascope-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">center</span><span class="o">+</span><span class="n">AF_range</span>              <span class="c1"># starting maximum z-height for autofocus</span>
</span><span id="Lumascope-386"><a href="#Lumascope-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">AF_max</span>                  <span class="c1"># starting step size for autofocus</span>
</span><span id="Lumascope-387"><a href="#Lumascope-387"><span class="linenos">387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exposure_time</span><span class="p">()</span>  <span class="c1"># camera exposure to determine &#39;wait&#39; time</span>
</span><span id="Lumascope-388"><a href="#Lumascope-388"><span class="linenos">388</span></a>
</span><span id="Lumascope-389"><a href="#Lumascope-389"><span class="linenos">389</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># List of positions to step through</span>
</span><span id="Lumascope-390"><a href="#Lumascope-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Measure focus score at each position</span>
</span><span id="Lumascope-391"><a href="#Lumascope-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_focus</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># Last / Previous focus score</span>
</span><span id="Lumascope-392"><a href="#Lumascope-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">False</span>         <span class="c1"># Are we on the last scan for autofocus?</span>
</span><span id="Lumascope-393"><a href="#Lumascope-393"><span class="linenos">393</span></a>
</span><span id="Lumascope-394"><a href="#Lumascope-394"><span class="linenos">394</span></a>        <span class="c1"># Start the autofocus process at z-minimum</span>
</span><span id="Lumascope-395"><a href="#Lumascope-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
</span><span id="Lumascope-396"><a href="#Lumascope-396"><span class="linenos">396</span></a>
</span><span id="Lumascope-397"><a href="#Lumascope-397"><span class="linenos">397</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span><span class="p">:</span>
</span><span id="Lumascope-398"><a href="#Lumascope-398"><span class="linenos">398</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="Lumascope-399"><a href="#Lumascope-399"><span class="linenos">399</span></a>
</span><span id="Lumascope-400"><a href="#Lumascope-400"><span class="linenos">400</span></a>            <span class="c1"># If the z-height has reached its target</span>
</span><span id="Lumascope-401"><a href="#Lumascope-401"><span class="linenos">401</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_status</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_overshoot</span><span class="p">():</span>
</span><span id="Lumascope-402"><a href="#Lumascope-402"><span class="linenos">402</span></a>                
</span><span id="Lumascope-403"><a href="#Lumascope-403"><span class="linenos">403</span></a>                <span class="c1"># Wait two exposure lengths</span>
</span><span id="Lumascope-404"><a href="#Lumascope-404"><span class="linenos">404</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exposure</span><span class="o">/</span><span class="mi">1000</span><span class="o">+</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># msec into sec</span>
</span><span id="Lumascope-405"><a href="#Lumascope-405"><span class="linenos">405</span></a>
</span><span id="Lumascope-406"><a href="#Lumascope-406"><span class="linenos">406</span></a>                <span class="c1"># observe the image </span>
</span><span id="Lumascope-407"><a href="#Lumascope-407"><span class="linenos">407</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="Lumascope-408"><a href="#Lumascope-408"><span class="linenos">408</span></a>                <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Lumascope-409"><a href="#Lumascope-409"><span class="linenos">409</span></a>
</span><span id="Lumascope-410"><a href="#Lumascope-410"><span class="linenos">410</span></a>                <span class="c1"># Use center quarter of image for focusing</span>
</span><span id="Lumascope-411"><a href="#Lumascope-411"><span class="linenos">411</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rows</span><span class="o">/</span><span class="mi">4</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">rows</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">cols</span><span class="o">/</span><span class="mi">4</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cols</span><span class="o">/</span><span class="mi">4</span><span class="p">)]</span>
</span><span id="Lumascope-412"><a href="#Lumascope-412"><span class="linenos">412</span></a>
</span><span id="Lumascope-413"><a href="#Lumascope-413"><span class="linenos">413</span></a>                <span class="c1"># calculate the position and focus measure</span>
</span><span id="Lumascope-414"><a href="#Lumascope-414"><span class="linenos">414</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope-415"><a href="#Lumascope-415"><span class="linenos">415</span></a>                    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
</span><span id="Lumascope-416"><a href="#Lumascope-416"><span class="linenos">416</span></a>                    <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_function</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="Lumascope-417"><a href="#Lumascope-417"><span class="linenos">417</span></a>                    <span class="n">next_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="Lumascope-418"><a href="#Lumascope-418"><span class="linenos">418</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope-419"><a href="#Lumascope-419"><span class="linenos">419</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Error talking to motion controller.&#39;</span><span class="p">)</span>
</span><span id="Lumascope-420"><a href="#Lumascope-420"><span class="linenos">420</span></a>                    <span class="k">raise</span>
</span><span id="Lumascope-421"><a href="#Lumascope-421"><span class="linenos">421</span></a>
</span><span id="Lumascope-422"><a href="#Lumascope-422"><span class="linenos">422</span></a>                <span class="c1"># append to positions and focus measures</span>
</span><span id="Lumascope-423"><a href="#Lumascope-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</span><span id="Lumascope-424"><a href="#Lumascope-424"><span class="linenos">424</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">focus</span><span class="p">)</span>
</span><span id="Lumascope-425"><a href="#Lumascope-425"><span class="linenos">425</span></a>
</span><span id="Lumascope-426"><a href="#Lumascope-426"><span class="linenos">426</span></a>                <span class="c1"># if (focus &lt; self.last_focus) or (next_target &gt; self.z_max):</span>
</span><span id="Lumascope-427"><a href="#Lumascope-427"><span class="linenos">427</span></a>                <span class="k">if</span> <span class="n">next_target</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">:</span>
</span><span id="Lumascope-428"><a href="#Lumascope-428"><span class="linenos">428</span></a>
</span><span id="Lumascope-429"><a href="#Lumascope-429"><span class="linenos">429</span></a>                    <span class="c1"># Calculate new step size for resolution</span>
</span><span id="Lumascope-430"><a href="#Lumascope-430"><span class="linenos">430</span></a>                    <span class="n">prev_resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="Lumascope-431"><a href="#Lumascope-431"><span class="linenos">431</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">prev_resolution</span> <span class="o">/</span> <span class="mi">3</span> <span class="c1"># SELECT DESIRED RESOLUTION FRACTION</span>
</span><span id="Lumascope-432"><a href="#Lumascope-432"><span class="linenos">432</span></a>
</span><span id="Lumascope-433"><a href="#Lumascope-433"><span class="linenos">433</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">&lt;</span> <span class="n">AF_min</span><span class="p">:</span>
</span><span id="Lumascope-434"><a href="#Lumascope-434"><span class="linenos">434</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">AF_min</span>
</span><span id="Lumascope-435"><a href="#Lumascope-435"><span class="linenos">435</span></a>
</span><span id="Lumascope-436"><a href="#Lumascope-436"><span class="linenos">436</span></a>                    <span class="c1"># As long as the step size is larger than or equal to the minimum and not the last pass</span>
</span><span id="Lumascope-437"><a href="#Lumascope-437"><span class="linenos">437</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">&gt;=</span> <span class="n">AF_min</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">:</span>
</span><span id="Lumascope-438"><a href="#Lumascope-438"><span class="linenos">438</span></a>
</span><span id="Lumascope-439"><a href="#Lumascope-439"><span class="linenos">439</span></a>                        <span class="c1"># compute best focus</span>
</span><span id="Lumascope-440"><a href="#Lumascope-440"><span class="linenos">440</span></a>                        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="p">)</span>
</span><span id="Lumascope-441"><a href="#Lumascope-441"><span class="linenos">441</span></a>
</span><span id="Lumascope-442"><a href="#Lumascope-442"><span class="linenos">442</span></a>                        <span class="c1"># assign new z_min, z_max, resolution, and sweep</span>
</span><span id="Lumascope-443"><a href="#Lumascope-443"><span class="linenos">443</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="n">focus</span><span class="o">-</span><span class="n">prev_resolution</span> 
</span><span id="Lumascope-444"><a href="#Lumascope-444"><span class="linenos">444</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">focus</span><span class="o">+</span><span class="n">prev_resolution</span> 
</span><span id="Lumascope-445"><a href="#Lumascope-445"><span class="linenos">445</span></a>
</span><span id="Lumascope-446"><a href="#Lumascope-446"><span class="linenos">446</span></a>                        <span class="c1"># reset positions and focus measures</span>
</span><span id="Lumascope-447"><a href="#Lumascope-447"><span class="linenos">447</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Lumascope-448"><a href="#Lumascope-448"><span class="linenos">448</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Lumascope-449"><a href="#Lumascope-449"><span class="linenos">449</span></a>
</span><span id="Lumascope-450"><a href="#Lumascope-450"><span class="linenos">450</span></a>                        <span class="c1"># go to new z_min</span>
</span><span id="Lumascope-451"><a href="#Lumascope-451"><span class="linenos">451</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
</span><span id="Lumascope-452"><a href="#Lumascope-452"><span class="linenos">452</span></a>
</span><span id="Lumascope-453"><a href="#Lumascope-453"><span class="linenos">453</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">==</span> <span class="n">AF_min</span><span class="p">:</span>
</span><span id="Lumascope-454"><a href="#Lumascope-454"><span class="linenos">454</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Lumascope-455"><a href="#Lumascope-455"><span class="linenos">455</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.last = True&#39;</span><span class="p">)</span>
</span><span id="Lumascope-456"><a href="#Lumascope-456"><span class="linenos">456</span></a>                    <span class="k">else</span><span class="p">:</span> <span class="c1"># self.resolution &gt;= AF_min and not self.last</span>
</span><span id="Lumascope-457"><a href="#Lumascope-457"><span class="linenos">457</span></a>                        <span class="c1"># compute best focus</span>
</span><span id="Lumascope-458"><a href="#Lumascope-458"><span class="linenos">458</span></a>                        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="p">)</span>
</span><span id="Lumascope-459"><a href="#Lumascope-459"><span class="linenos">459</span></a>                        
</span><span id="Lumascope-460"><a href="#Lumascope-460"><span class="linenos">460</span></a>                        <span class="c1"># go to best focus</span>
</span><span id="Lumascope-461"><a href="#Lumascope-461"><span class="linenos">461</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="c1"># move to absolute target</span>
</span><span id="Lumascope-462"><a href="#Lumascope-462"><span class="linenos">462</span></a>                        
</span><span id="Lumascope-463"><a href="#Lumascope-463"><span class="linenos">463</span></a>                        <span class="c1"># end autofocus sequence</span>
</span><span id="Lumascope-464"><a href="#Lumascope-464"><span class="linenos">464</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Lumascope-465"><a href="#Lumascope-465"><span class="linenos">465</span></a>                        
</span><span id="Lumascope-466"><a href="#Lumascope-466"><span class="linenos">466</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">is_complete</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Lumascope-467"><a href="#Lumascope-467"><span class="linenos">467</span></a>
</span><span id="Lumascope-468"><a href="#Lumascope-468"><span class="linenos">468</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope-469"><a href="#Lumascope-469"><span class="linenos">469</span></a>                    <span class="c1"># move to next position</span>
</span><span id="Lumascope-470"><a href="#Lumascope-470"><span class="linenos">470</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">move_relative_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="Lumascope-471"><a href="#Lumascope-471"><span class="linenos">471</span></a>
</span><span id="Lumascope-472"><a href="#Lumascope-472"><span class="linenos">472</span></a>                <span class="c1"># update last focus</span>
</span><span id="Lumascope-473"><a href="#Lumascope-473"><span class="linenos">473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_focus</span> <span class="o">=</span> <span class="n">focus</span>
</span><span id="Lumascope-474"><a href="#Lumascope-474"><span class="linenos">474</span></a>
</span><span id="Lumascope-475"><a href="#Lumascope-475"><span class="linenos">475</span></a>    <span class="c1"># Algorithms for estimating the quality of the focus</span>
</span><span id="Lumascope-476"><a href="#Lumascope-476"><span class="linenos">476</span></a>    <span class="k">def</span> <span class="nf">focus_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s1">&#39;vollath4&#39;</span><span class="p">):</span>
</span><span id="Lumascope-477"><a href="#Lumascope-477"><span class="linenos">477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="Lumascope-478"><a href="#Lumascope-478"><span class="linenos">478</span></a><span class="sd">        assess focus value at specific position for autofocus function</span>
</span><span id="Lumascope-479"><a href="#Lumascope-479"><span class="linenos">479</span></a><span class="sd">        (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="Lumascope-480"><a href="#Lumascope-480"><span class="linenos">480</span></a>
</span><span id="Lumascope-481"><a href="#Lumascope-481"><span class="linenos">481</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] VerticalControl.focus_function()&#39;</span><span class="p">)</span>
</span><span id="Lumascope-482"><a href="#Lumascope-482"><span class="linenos">482</span></a>        <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Lumascope-483"><a href="#Lumascope-483"><span class="linenos">483</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Lumascope-484"><a href="#Lumascope-484"><span class="linenos">484</span></a>
</span><span id="Lumascope-485"><a href="#Lumascope-485"><span class="linenos">485</span></a>        <span class="c1"># Journal of Microscopy, Vol. 188, Pt 3, December 1997, pp. 264–272</span>
</span><span id="Lumascope-486"><a href="#Lumascope-486"><span class="linenos">486</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;vollath4&#39;</span><span class="p">:</span> <span class="c1"># pg 266</span>
</span><span id="Lumascope-487"><a href="#Lumascope-487"><span class="linenos">487</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="Lumascope-488"><a href="#Lumascope-488"><span class="linenos">488</span></a>            <span class="n">sum_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">image</span><span class="p">[:</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="n">h</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">w</span><span class="p">,:</span><span class="n">h</span><span class="p">]))</span> <span class="c1"># g(i, j).g(i+1, j)</span>
</span><span id="Lumascope-489"><a href="#Lumascope-489"><span class="linenos">489</span></a>            <span class="n">sum_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">image</span><span class="p">[:</span><span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">,:</span><span class="n">h</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">w</span><span class="p">,:</span><span class="n">h</span><span class="p">]))</span> <span class="c1"># g(i, j).g(i+2, j)</span>
</span><span id="Lumascope-490"><a href="#Lumascope-490"><span class="linenos">490</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Vollath: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sum_one</span> <span class="o">-</span> <span class="n">sum_two</span><span class="p">))</span>
</span><span id="Lumascope-491"><a href="#Lumascope-491"><span class="linenos">491</span></a>            <span class="k">return</span> <span class="n">sum_one</span> <span class="o">-</span> <span class="n">sum_two</span>
</span><span id="Lumascope-492"><a href="#Lumascope-492"><span class="linenos">492</span></a>
</span><span id="Lumascope-493"><a href="#Lumascope-493"><span class="linenos">493</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;skew&#39;</span><span class="p">:</span>
</span><span id="Lumascope-494"><a href="#Lumascope-494"><span class="linenos">494</span></a>            <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">))</span>
</span><span id="Lumascope-495"><a href="#Lumascope-495"><span class="linenos">495</span></a>            <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="Lumascope-496"><a href="#Lumascope-496"><span class="linenos">496</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="Lumascope-497"><a href="#Lumascope-497"><span class="linenos">497</span></a>
</span><span id="Lumascope-498"><a href="#Lumascope-498"><span class="linenos">498</span></a>            <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Lumascope-499"><a href="#Lumascope-499"><span class="linenos">499</span></a>            <span class="n">white_edge</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Lumascope-500"><a href="#Lumascope-500"><span class="linenos">500</span></a>
</span><span id="Lumascope-501"><a href="#Lumascope-501"><span class="linenos">501</span></a>            <span class="n">skew</span> <span class="o">=</span> <span class="n">white_edge</span><span class="o">-</span><span class="n">max_index</span>
</span><span id="Lumascope-502"><a href="#Lumascope-502"><span class="linenos">502</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Skew: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">skew</span><span class="p">))</span>
</span><span id="Lumascope-503"><a href="#Lumascope-503"><span class="linenos">503</span></a>            <span class="k">return</span> <span class="n">skew</span>
</span><span id="Lumascope-504"><a href="#Lumascope-504"><span class="linenos">504</span></a>
</span><span id="Lumascope-505"><a href="#Lumascope-505"><span class="linenos">505</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;pixel_variation&#39;</span><span class="p">:</span>
</span><span id="Lumascope-506"><a href="#Lumascope-506"><span class="linenos">506</span></a>            <span class="nb">sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="Lumascope-507"><a href="#Lumascope-507"><span class="linenos">507</span></a>            <span class="n">ssq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
</span><span id="Lumascope-508"><a href="#Lumascope-508"><span class="linenos">508</span></a>            <span class="n">var</span> <span class="o">=</span> <span class="n">ssq</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="nb">sum</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Lumascope-509"><a href="#Lumascope-509"><span class="linenos">509</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Pixel Variation: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
</span><span id="Lumascope-510"><a href="#Lumascope-510"><span class="linenos">510</span></a>            <span class="k">return</span> <span class="n">var</span>
</span><span id="Lumascope-511"><a href="#Lumascope-511"><span class="linenos">511</span></a><span class="w">        </span>
</span><span id="Lumascope-512"><a href="#Lumascope-512"><span class="linenos">512</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Lumascope-513"><a href="#Lumascope-513"><span class="linenos">513</span></a><span class="sd">        elif algorithm == &#39;convolve2D&#39;:</span>
</span><span id="Lumascope-514"><a href="#Lumascope-514"><span class="linenos">514</span></a><span class="sd">            # Bueno-Ibarra et al. Optical Engineering 44(6), 063601 (June 2005)</span>
</span><span id="Lumascope-515"><a href="#Lumascope-515"><span class="linenos">515</span></a><span class="sd">            kernel = np.array([ [0, -1, 0],</span>
</span><span id="Lumascope-516"><a href="#Lumascope-516"><span class="linenos">516</span></a><span class="sd">                                [-1, 4,-1],</span>
</span><span id="Lumascope-517"><a href="#Lumascope-517"><span class="linenos">517</span></a><span class="sd">                                [0, -1, 0]], dtype=&#39;float&#39;) / 6</span>
</span><span id="Lumascope-518"><a href="#Lumascope-518"><span class="linenos">518</span></a><span class="sd">            n = 9</span>
</span><span id="Lumascope-519"><a href="#Lumascope-519"><span class="linenos">519</span></a><span class="sd">            a = 1</span>
</span><span id="Lumascope-520"><a href="#Lumascope-520"><span class="linenos">520</span></a><span class="sd">            kernel = np.zeros([n,n])</span>
</span><span id="Lumascope-521"><a href="#Lumascope-521"><span class="linenos">521</span></a><span class="sd">            for i in range(n):</span>
</span><span id="Lumascope-522"><a href="#Lumascope-522"><span class="linenos">522</span></a><span class="sd">                for j in range(n):</span>
</span><span id="Lumascope-523"><a href="#Lumascope-523"><span class="linenos">523</span></a><span class="sd">                    r2 = ((i-(n-1)/2)**2 + (j-(n-1)/2)**2)/a**2</span>
</span><span id="Lumascope-524"><a href="#Lumascope-524"><span class="linenos">524</span></a><span class="sd">                    kernel[i,j] = 2*(1-r2)*np.exp(-0.5*r2)/np.sqrt(3*a)</span>
</span><span id="Lumascope-525"><a href="#Lumascope-525"><span class="linenos">525</span></a><span class="sd">            print(&#39;[LVP Main  ] kernel\t&#39; + str(kernel))</span>
</span><span id="Lumascope-526"><a href="#Lumascope-526"><span class="linenos">526</span></a><span class="sd">            convolve = signal.convolve2d(image, kernel, mode=&#39;valid&#39;)</span>
</span><span id="Lumascope-527"><a href="#Lumascope-527"><span class="linenos">527</span></a><span class="sd">            sum = np.sum(convolve)</span>
</span><span id="Lumascope-528"><a href="#Lumascope-528"><span class="linenos">528</span></a><span class="sd">            print(&#39;[LVP Main  ] sum\t&#39; + str(sum))</span>
</span><span id="Lumascope-529"><a href="#Lumascope-529"><span class="linenos">529</span></a><span class="sd">            return sum</span>
</span><span id="Lumascope-530"><a href="#Lumascope-530"><span class="linenos">530</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="Lumascope-531"><a href="#Lumascope-531"><span class="linenos">531</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope-532"><a href="#Lumascope-532"><span class="linenos">532</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope-533"><a href="#Lumascope-533"><span class="linenos">533</span></a>
</span><span id="Lumascope-534"><a href="#Lumascope-534"><span class="linenos">534</span></a>    <span class="k">def</span> <span class="nf">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">):</span>
</span><span id="Lumascope-535"><a href="#Lumascope-535"><span class="linenos">535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="Lumascope-536"><a href="#Lumascope-536"><span class="linenos">536</span></a><span class="sd">        select best focus position for autofocus function</span>
</span><span id="Lumascope-537"><a href="#Lumascope-537"><span class="linenos">537</span></a><span class="sd">        (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="Lumascope-538"><a href="#Lumascope-538"><span class="linenos">538</span></a>
</span><span id="Lumascope-539"><a href="#Lumascope-539"><span class="linenos">539</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] VerticalControl.focus_best()&#39;</span><span class="p">)</span>
</span><span id="Lumascope-540"><a href="#Lumascope-540"><span class="linenos">540</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;direct&#39;</span><span class="p">:</span>
</span><span id="Lumascope-541"><a href="#Lumascope-541"><span class="linenos">541</span></a>            <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="Lumascope-542"><a href="#Lumascope-542"><span class="linenos">542</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span>
</span><span id="Lumascope-543"><a href="#Lumascope-543"><span class="linenos">543</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>
</span><span id="Lumascope-544"><a href="#Lumascope-544"><span class="linenos">544</span></a>
</span><span id="Lumascope-545"><a href="#Lumascope-545"><span class="linenos">545</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;mov_avg&#39;</span><span class="p">:</span>
</span><span id="Lumascope-546"><a href="#Lumascope-546"><span class="linenos">546</span></a>            <span class="n">avg_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
</span><span id="Lumascope-547"><a href="#Lumascope-547"><span class="linenos">547</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">avg_values</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="Lumascope-548"><a href="#Lumascope-548"><span class="linenos">548</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>
</span><span id="Lumascope-549"><a href="#Lumascope-549"><span class="linenos">549</span></a>
</span><span id="Lumascope-550"><a href="#Lumascope-550"><span class="linenos">550</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope-551"><a href="#Lumascope-551"><span class="linenos">551</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


    

                            <div id="Lumascope.__init__" class="classattr">
                                        <input id="Lumascope.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Lumascope</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="Lumascope.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.__init__-49"><a href="#Lumascope.__init__-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.__init__-50"><a href="#Lumascope.__init__-50"><span class="linenos">50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Microscope&quot;&quot;&quot;</span>
</span><span id="Lumascope.__init__-51"><a href="#Lumascope.__init__-51"><span class="linenos">51</span></a>
</span><span id="Lumascope.__init__-52"><a href="#Lumascope.__init__-52"><span class="linenos">52</span></a>        <span class="c1"># LED Control Board</span>
</span><span id="Lumascope.__init__-53"><a href="#Lumascope.__init__-53"><span class="linenos">53</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope.__init__-54"><a href="#Lumascope.__init__-54"><span class="linenos">54</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">led</span> <span class="o">=</span> <span class="n">LEDBoard</span><span class="p">()</span>
</span><span id="Lumascope.__init__-55"><a href="#Lumascope.__init__-55"><span class="linenos">55</span></a>
</span><span id="Lumascope.__init__-56"><a href="#Lumascope.__init__-56"><span class="linenos">56</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope.__init__-57"><a href="#Lumascope.__init__-57"><span class="linenos">57</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] LED Board Not Initialized&#39;</span><span class="p">)</span>
</span><span id="Lumascope.__init__-58"><a href="#Lumascope.__init__-58"><span class="linenos">58</span></a>        
</span><span id="Lumascope.__init__-59"><a href="#Lumascope.__init__-59"><span class="linenos">59</span></a>        <span class="c1"># Motion Control Board</span>
</span><span id="Lumascope.__init__-60"><a href="#Lumascope.__init__-60"><span class="linenos">60</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope.__init__-61"><a href="#Lumascope.__init__-61"><span class="linenos">61</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion</span> <span class="o">=</span> <span class="n">MotorBoard</span><span class="p">()</span>
</span><span id="Lumascope.__init__-62"><a href="#Lumascope.__init__-62"><span class="linenos">62</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope.__init__-63"><a href="#Lumascope.__init__-63"><span class="linenos">63</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Motion Board Not Initialized&#39;</span><span class="p">)</span>
</span><span id="Lumascope.__init__-64"><a href="#Lumascope.__init__-64"><span class="linenos">64</span></a>
</span><span id="Lumascope.__init__-65"><a href="#Lumascope.__init__-65"><span class="linenos">65</span></a>        <span class="c1"># Camera</span>
</span><span id="Lumascope.__init__-66"><a href="#Lumascope.__init__-66"><span class="linenos">66</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope.__init__-67"><a href="#Lumascope.__init__-67"><span class="linenos">67</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">PylonCamera</span><span class="p">()</span>
</span><span id="Lumascope.__init__-68"><a href="#Lumascope.__init__-68"><span class="linenos">68</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope.__init__-69"><a href="#Lumascope.__init__-69"><span class="linenos">69</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Camera Board Not Initialized&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize Microscope</p>
</div>


                            </div>
                            <div id="Lumascope.leds_enable" class="classattr">
                                        <input id="Lumascope.leds_enable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">leds_enable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.leds_enable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.leds_enable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.leds_enable-76"><a href="#Lumascope.leds_enable-76"><span class="linenos">76</span></a>    <span class="k">def</span> <span class="nf">leds_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.leds_enable-77"><a href="#Lumascope.leds_enable-77"><span class="linenos">77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope.leds_enable-78"><a href="#Lumascope.leds_enable-78"><span class="linenos">78</span></a><span class="sd">        Enable all LEDS&quot;&quot;&quot;</span>
</span><span id="Lumascope.leds_enable-79"><a href="#Lumascope.leds_enable-79"><span class="linenos">79</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.leds_enable-80"><a href="#Lumascope.leds_enable-80"><span class="linenos">80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_enable</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>LED BOARD FUNCTIONS
Enable all LEDS</p>
</div>


                            </div>
                            <div id="Lumascope.leds_disable" class="classattr">
                                        <input id="Lumascope.leds_disable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">leds_disable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.leds_disable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.leds_disable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.leds_disable-82"><a href="#Lumascope.leds_disable-82"><span class="linenos">82</span></a>    <span class="k">def</span> <span class="nf">leds_disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.leds_disable-83"><a href="#Lumascope.leds_disable-83"><span class="linenos">83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope.leds_disable-84"><a href="#Lumascope.leds_disable-84"><span class="linenos">84</span></a><span class="sd">        Disable all LEDS&quot;&quot;&quot;</span>
</span><span id="Lumascope.leds_disable-85"><a href="#Lumascope.leds_disable-85"><span class="linenos">85</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.leds_disable-86"><a href="#Lumascope.leds_disable-86"><span class="linenos">86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_disable</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>LED BOARD FUNCTIONS
Disable all LEDS</p>
</div>


                            </div>
                            <div id="Lumascope.led_on" class="classattr">
                                        <input id="Lumascope.led_on-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">led_on</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">channel</span>, </span><span class="param"><span class="n">mA</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.led_on-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.led_on"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.led_on-88"><a href="#Lumascope.led_on-88"><span class="linenos">88</span></a>    <span class="k">def</span> <span class="nf">led_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">mA</span><span class="p">):</span>
</span><span id="Lumascope.led_on-89"><a href="#Lumascope.led_on-89"><span class="linenos">89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope.led_on-90"><a href="#Lumascope.led_on-90"><span class="linenos">90</span></a><span class="sd">        Turn on LED at channel number at mA power &quot;&quot;&quot;</span>
</span><span id="Lumascope.led_on-91"><a href="#Lumascope.led_on-91"><span class="linenos">91</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.led_on-92"><a href="#Lumascope.led_on-92"><span class="linenos">92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">led_on</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">mA</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>LED BOARD FUNCTIONS
Turn on LED at channel number at mA power</p>
</div>


                            </div>
                            <div id="Lumascope.led_off" class="classattr">
                                        <input id="Lumascope.led_off-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">led_off</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">channel</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.led_off-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.led_off"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.led_off-94"><a href="#Lumascope.led_off-94"><span class="linenos">94</span></a>    <span class="k">def</span> <span class="nf">led_off</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
</span><span id="Lumascope.led_off-95"><a href="#Lumascope.led_off-95"><span class="linenos">95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope.led_off-96"><a href="#Lumascope.led_off-96"><span class="linenos">96</span></a><span class="sd">        Turn off LED at channel number &quot;&quot;&quot;</span>
</span><span id="Lumascope.led_off-97"><a href="#Lumascope.led_off-97"><span class="linenos">97</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.led_off-98"><a href="#Lumascope.led_off-98"><span class="linenos">98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">led_off</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>LED BOARD FUNCTIONS
Turn off LED at channel number</p>
</div>


                            </div>
                            <div id="Lumascope.leds_off" class="classattr">
                                        <input id="Lumascope.leds_off-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">leds_off</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.leds_off-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.leds_off"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.leds_off-100"><a href="#Lumascope.leds_off-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">leds_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.leds_off-101"><a href="#Lumascope.leds_off-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope.leds_off-102"><a href="#Lumascope.leds_off-102"><span class="linenos">102</span></a><span class="sd">        Turn off all LEDs &quot;&quot;&quot;</span>
</span><span id="Lumascope.leds_off-103"><a href="#Lumascope.leds_off-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.leds_off-104"><a href="#Lumascope.leds_off-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">leds_off</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>LED BOARD FUNCTIONS
Turn off all LEDs</p>
</div>


                            </div>
                            <div id="Lumascope.ch2color" class="classattr">
                                        <input id="Lumascope.ch2color-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ch2color</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">color</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.ch2color-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.ch2color"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.ch2color-106"><a href="#Lumascope.ch2color-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">ch2color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="Lumascope.ch2color-107"><a href="#Lumascope.ch2color-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope.ch2color-108"><a href="#Lumascope.ch2color-108"><span class="linenos">108</span></a><span class="sd">        Convert channel number to string representing color</span>
</span><span id="Lumascope.ch2color-109"><a href="#Lumascope.ch2color-109"><span class="linenos">109</span></a><span class="sd">         0 -&gt; Blue: Fluorescence</span>
</span><span id="Lumascope.ch2color-110"><a href="#Lumascope.ch2color-110"><span class="linenos">110</span></a><span class="sd">         1 -&gt; Green: Fluorescence</span>
</span><span id="Lumascope.ch2color-111"><a href="#Lumascope.ch2color-111"><span class="linenos">111</span></a><span class="sd">         2 -&gt; Red: Fluorescence</span>
</span><span id="Lumascope.ch2color-112"><a href="#Lumascope.ch2color-112"><span class="linenos">112</span></a><span class="sd">         3 -&gt; BF: Brightfield</span>
</span><span id="Lumascope.ch2color-113"><a href="#Lumascope.ch2color-113"><span class="linenos">113</span></a><span class="sd">         4 -&gt; PC: Phase Contrast</span>
</span><span id="Lumascope.ch2color-114"><a href="#Lumascope.ch2color-114"><span class="linenos">114</span></a><span class="sd">         5 -&gt; DF: Low Mag Darkfield</span>
</span><span id="Lumascope.ch2color-115"><a href="#Lumascope.ch2color-115"><span class="linenos">115</span></a><span class="sd">           &quot;&quot;&quot;</span>
</span><span id="Lumascope.ch2color-116"><a href="#Lumascope.ch2color-116"><span class="linenos">116</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.ch2color-117"><a href="#Lumascope.ch2color-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">ch2color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>LED BOARD FUNCTIONS
Convert channel number to string representing color
 0 -> Blue: Fluorescence
 1 -> Green: Fluorescence
 2 -> Red: Fluorescence
 3 -> BF: Brightfield
 4 -> PC: Phase Contrast
 5 -> DF: Low Mag Darkfield</p>
</div>


                            </div>
                            <div id="Lumascope.color2ch" class="classattr">
                                        <input id="Lumascope.color2ch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">color2ch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">color</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.color2ch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.color2ch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.color2ch-119"><a href="#Lumascope.color2ch-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">color2ch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="Lumascope.color2ch-120"><a href="#Lumascope.color2ch-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; LED BOARD FUNCTIONS</span>
</span><span id="Lumascope.color2ch-121"><a href="#Lumascope.color2ch-121"><span class="linenos">121</span></a><span class="sd">        Convert string representing color to channel number</span>
</span><span id="Lumascope.color2ch-122"><a href="#Lumascope.color2ch-122"><span class="linenos">122</span></a><span class="sd">         Blue: Fluorescence Channel 0   -&gt; 0</span>
</span><span id="Lumascope.color2ch-123"><a href="#Lumascope.color2ch-123"><span class="linenos">123</span></a><span class="sd">         Green: Fluorescence Channel 1  -&gt; 1</span>
</span><span id="Lumascope.color2ch-124"><a href="#Lumascope.color2ch-124"><span class="linenos">124</span></a><span class="sd">         Red: Fluorescence Channel 2    -&gt; 2</span>
</span><span id="Lumascope.color2ch-125"><a href="#Lumascope.color2ch-125"><span class="linenos">125</span></a><span class="sd">         BF: Brightfield                -&gt; 3</span>
</span><span id="Lumascope.color2ch-126"><a href="#Lumascope.color2ch-126"><span class="linenos">126</span></a><span class="sd">         PC: Phase Contrast             -&gt; 4</span>
</span><span id="Lumascope.color2ch-127"><a href="#Lumascope.color2ch-127"><span class="linenos">127</span></a><span class="sd">         DF: Low Mag Darkfield          -&gt; 5</span>
</span><span id="Lumascope.color2ch-128"><a href="#Lumascope.color2ch-128"><span class="linenos">128</span></a><span class="sd">           &quot;&quot;&quot;</span>
</span><span id="Lumascope.color2ch-129"><a href="#Lumascope.color2ch-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.color2ch-130"><a href="#Lumascope.color2ch-130"><span class="linenos">130</span></a>        
</span><span id="Lumascope.color2ch-131"><a href="#Lumascope.color2ch-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">color2ch</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>LED BOARD FUNCTIONS
Convert string representing color to channel number
 Blue: Fluorescence Channel 0   -> 0
 Green: Fluorescence Channel 1  -> 1
 Red: Fluorescence Channel 2    -> 2
 BF: Brightfield                -> 3
 PC: Phase Contrast             -> 4
 DF: Low Mag Darkfield          -> 5</p>
</div>


                            </div>
                            <div id="Lumascope.get_image" class="classattr">
                                        <input id="Lumascope.get_image-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_image</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_image-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_image"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_image-137"><a href="#Lumascope.get_image-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.get_image-138"><a href="#Lumascope.get_image-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; CAMERA FUNCTIONS</span>
</span><span id="Lumascope.get_image-139"><a href="#Lumascope.get_image-139"><span class="linenos">139</span></a><span class="sd">        Grab and return image from camera&quot;&quot;&quot;</span>
</span><span id="Lumascope.get_image-140"><a href="#Lumascope.get_image-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">grab</span><span class="p">():</span>
</span><span id="Lumascope.get_image-141"><a href="#Lumascope.get_image-141"><span class="linenos">141</span></a>            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">array</span>
</span><span id="Lumascope.get_image-142"><a href="#Lumascope.get_image-142"><span class="linenos">142</span></a>            <span class="k">return</span> <span class="n">array</span>
</span><span id="Lumascope.get_image-143"><a href="#Lumascope.get_image-143"><span class="linenos">143</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope.get_image-144"><a href="#Lumascope.get_image-144"><span class="linenos">144</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Grab and return image from camera</p>
</div>


                            </div>
                            <div id="Lumascope.save_image" class="classattr">
                                        <input id="Lumascope.save_image-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_image</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;./capture&#39;</span>,</span><span class="param">	<span class="n">file_root</span><span class="o">=</span><span class="s1">&#39;img_&#39;</span>,</span><span class="param">	<span class="n">append</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="s1">&#39;BF&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.save_image-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.save_image"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.save_image-146"><a href="#Lumascope.save_image-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">save_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_folder</span> <span class="o">=</span> <span class="s1">&#39;./capture&#39;</span><span class="p">,</span> <span class="n">file_root</span> <span class="o">=</span> <span class="s1">&#39;img_&#39;</span><span class="p">,</span> <span class="n">append</span> <span class="o">=</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;BF&#39;</span><span class="p">):</span>
</span><span id="Lumascope.save_image-147"><a href="#Lumascope.save_image-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.save_image-148"><a href="#Lumascope.save_image-148"><span class="linenos">148</span></a><span class="sd">        Grab the current live image and save to file</span>
</span><span id="Lumascope.save_image-149"><a href="#Lumascope.save_image-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope.save_image-150"><a href="#Lumascope.save_image-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
</span><span id="Lumascope.save_image-151"><a href="#Lumascope.save_image-151"><span class="linenos">151</span></a>            <span class="k">return</span>
</span><span id="Lumascope.save_image-152"><a href="#Lumascope.save_image-152"><span class="linenos">152</span></a>        
</span><span id="Lumascope.save_image-153"><a href="#Lumascope.save_image-153"><span class="linenos">153</span></a>        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="Lumascope.save_image-154"><a href="#Lumascope.save_image-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="Lumascope.save_image-155"><a href="#Lumascope.save_image-155"><span class="linenos">155</span></a>            <span class="k">return</span> 
</span><span id="Lumascope.save_image-156"><a href="#Lumascope.save_image-156"><span class="linenos">156</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Lumascope.save_image-157"><a href="#Lumascope.save_image-157"><span class="linenos">157</span></a>
</span><span id="Lumascope.save_image-158"><a href="#Lumascope.save_image-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Blue&#39;</span><span class="p">:</span>
</span><span id="Lumascope.save_image-159"><a href="#Lumascope.save_image-159"><span class="linenos">159</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope.save_image-160"><a href="#Lumascope.save_image-160"><span class="linenos">160</span></a>        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Green&#39;</span><span class="p">:</span>
</span><span id="Lumascope.save_image-161"><a href="#Lumascope.save_image-161"><span class="linenos">161</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope.save_image-162"><a href="#Lumascope.save_image-162"><span class="linenos">162</span></a>        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;Red&#39;</span><span class="p">:</span>
</span><span id="Lumascope.save_image-163"><a href="#Lumascope.save_image-163"><span class="linenos">163</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope.save_image-164"><a href="#Lumascope.save_image-164"><span class="linenos">164</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope.save_image-165"><a href="#Lumascope.save_image-165"><span class="linenos">165</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope.save_image-166"><a href="#Lumascope.save_image-166"><span class="linenos">166</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope.save_image-167"><a href="#Lumascope.save_image-167"><span class="linenos">167</span></a>            <span class="n">img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
</span><span id="Lumascope.save_image-168"><a href="#Lumascope.save_image-168"><span class="linenos">168</span></a>
</span><span id="Lumascope.save_image-169"><a href="#Lumascope.save_image-169"><span class="linenos">169</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Lumascope.save_image-170"><a href="#Lumascope.save_image-170"><span class="linenos">170</span></a>
</span><span id="Lumascope.save_image-171"><a href="#Lumascope.save_image-171"><span class="linenos">171</span></a>        <span class="c1"># set filename options</span>
</span><span id="Lumascope.save_image-172"><a href="#Lumascope.save_image-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">append</span> <span class="o">==</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span>
</span><span id="Lumascope.save_image-173"><a href="#Lumascope.save_image-173"><span class="linenos">173</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)))</span>
</span><span id="Lumascope.save_image-174"><a href="#Lumascope.save_image-174"><span class="linenos">174</span></a>        <span class="k">elif</span> <span class="n">append</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
</span><span id="Lumascope.save_image-175"><a href="#Lumascope.save_image-175"><span class="linenos">175</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
</span><span id="Lumascope.save_image-176"><a href="#Lumascope.save_image-176"><span class="linenos">176</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope.save_image-177"><a href="#Lumascope.save_image-177"><span class="linenos">177</span></a>            <span class="n">append</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Lumascope.save_image-178"><a href="#Lumascope.save_image-178"><span class="linenos">178</span></a>
</span><span id="Lumascope.save_image-179"><a href="#Lumascope.save_image-179"><span class="linenos">179</span></a>        <span class="c1"># generate filename string</span>
</span><span id="Lumascope.save_image-180"><a href="#Lumascope.save_image-180"><span class="linenos">180</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">file_root</span> <span class="o">+</span> <span class="n">append</span> <span class="o">+</span> <span class="s1">&#39;.tiff&#39;</span>
</span><span id="Lumascope.save_image-181"><a href="#Lumascope.save_image-181"><span class="linenos">181</span></a>
</span><span id="Lumascope.save_image-182"><a href="#Lumascope.save_image-182"><span class="linenos">182</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope.save_image-183"><a href="#Lumascope.save_image-183"><span class="linenos">183</span></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">filename</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
</span><span id="Lumascope.save_image-184"><a href="#Lumascope.save_image-184"><span class="linenos">184</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[SCOPE API ] Saving Image to&quot;</span><span class="p">,</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">filename</span> <span class="p">)</span>
</span><span id="Lumascope.save_image-185"><a href="#Lumascope.save_image-185"><span class="linenos">185</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope.save_image-186"><a href="#Lumascope.save_image-186"><span class="linenos">186</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[SCOPE API ] Error: Unable to save. Perhaps save folder does not exist?&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Grab the current live image and save to file</p>
</div>


                            </div>
                            <div id="Lumascope.get_max_width" class="classattr">
                                        <input id="Lumascope.get_max_width-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_max_width</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_max_width-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_max_width"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_max_width-188"><a href="#Lumascope.get_max_width-188"><span class="linenos">188</span></a>    <span class="k">def</span> <span class="nf">get_max_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.get_max_width-189"><a href="#Lumascope.get_max_width-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.get_max_width-190"><a href="#Lumascope.get_max_width-190"><span class="linenos">190</span></a><span class="sd">        Grab the max pixel width of camera</span>
</span><span id="Lumascope.get_max_width-191"><a href="#Lumascope.get_max_width-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope.get_max_width-192"><a href="#Lumascope.get_max_width-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope.get_max_width-193"><a href="#Lumascope.get_max_width-193"><span class="linenos">193</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Width</span><span class="o">.</span><span class="n">Max</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Grab the max pixel width of camera</p>
</div>


                            </div>
                            <div id="Lumascope.get_max_height" class="classattr">
                                        <input id="Lumascope.get_max_height-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_max_height</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_max_height-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_max_height"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_max_height-195"><a href="#Lumascope.get_max_height-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">get_max_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.get_max_height-196"><a href="#Lumascope.get_max_height-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.get_max_height-197"><a href="#Lumascope.get_max_height-197"><span class="linenos">197</span></a><span class="sd">        Grab the max pixel height of camera</span>
</span><span id="Lumascope.get_max_height-198"><a href="#Lumascope.get_max_height-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope.get_max_height-199"><a href="#Lumascope.get_max_height-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope.get_max_height-200"><a href="#Lumascope.get_max_height-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">Max</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Grab the max pixel height of camera</p>
</div>


                            </div>
                            <div id="Lumascope.get_width" class="classattr">
                                        <input id="Lumascope.get_width-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_width</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_width-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_width"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_width-202"><a href="#Lumascope.get_width-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">get_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.get_width-203"><a href="#Lumascope.get_width-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.get_width-204"><a href="#Lumascope.get_width-204"><span class="linenos">204</span></a><span class="sd">        Grab the current pixel width setting of camera</span>
</span><span id="Lumascope.get_width-205"><a href="#Lumascope.get_width-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope.get_width-206"><a href="#Lumascope.get_width-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope.get_width-207"><a href="#Lumascope.get_width-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Width</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Grab the current pixel width setting of camera</p>
</div>


                            </div>
                            <div id="Lumascope.get_height" class="classattr">
                                        <input id="Lumascope.get_height-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_height</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_height-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_height"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_height-209"><a href="#Lumascope.get_height-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">get_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.get_height-210"><a href="#Lumascope.get_height-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.get_height-211"><a href="#Lumascope.get_height-211"><span class="linenos">211</span></a><span class="sd">        Grab the current pixel height setting of camera</span>
</span><span id="Lumascope.get_height-212"><a href="#Lumascope.get_height-212"><span class="linenos">212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Lumascope.get_height-213"><a href="#Lumascope.get_height-213"><span class="linenos">213</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope.get_height-214"><a href="#Lumascope.get_height-214"><span class="linenos">214</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Grab the current pixel height setting of camera</p>
</div>


                            </div>
                            <div id="Lumascope.set_frame_size" class="classattr">
                                        <input id="Lumascope.set_frame_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_frame_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">w</span>, </span><span class="param"><span class="n">h</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.set_frame_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.set_frame_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.set_frame_size-216"><a href="#Lumascope.set_frame_size-216"><span class="linenos">216</span></a>    <span class="k">def</span> <span class="nf">set_frame_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
</span><span id="Lumascope.set_frame_size-217"><a href="#Lumascope.set_frame_size-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.set_frame_size-218"><a href="#Lumascope.set_frame_size-218"><span class="linenos">218</span></a><span class="sd">        Set frame size (pixel width by picel height</span>
</span><span id="Lumascope.set_frame_size-219"><a href="#Lumascope.set_frame_size-219"><span class="linenos">219</span></a><span class="sd">        of camera to w by h&quot;&quot;&quot;</span>
</span><span id="Lumascope.set_frame_size-220"><a href="#Lumascope.set_frame_size-220"><span class="linenos">220</span></a>
</span><span id="Lumascope.set_frame_size-221"><a href="#Lumascope.set_frame_size-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.set_frame_size-222"><a href="#Lumascope.set_frame_size-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">frame_size</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Set frame size (pixel width by picel height
of camera to w by h</p>
</div>


                            </div>
                            <div id="Lumascope.set_gain" class="classattr">
                                        <input id="Lumascope.set_gain-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_gain</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">gain</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.set_gain-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.set_gain"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.set_gain-224"><a href="#Lumascope.set_gain-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="nf">set_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gain</span><span class="p">):</span>
</span><span id="Lumascope.set_gain-225"><a href="#Lumascope.set_gain-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.set_gain-226"><a href="#Lumascope.set_gain-226"><span class="linenos">226</span></a><span class="sd">        Set camera gain&quot;&quot;&quot;</span>
</span><span id="Lumascope.set_gain-227"><a href="#Lumascope.set_gain-227"><span class="linenos">227</span></a>
</span><span id="Lumascope.set_gain-228"><a href="#Lumascope.set_gain-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.set_gain-229"><a href="#Lumascope.set_gain-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">gain</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Set camera gain</p>
</div>


                            </div>
                            <div id="Lumascope.set_auto_gain" class="classattr">
                                        <input id="Lumascope.set_auto_gain-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_auto_gain</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.set_auto_gain-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.set_auto_gain"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.set_auto_gain-231"><a href="#Lumascope.set_auto_gain-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">set_auto_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Lumascope.set_auto_gain-232"><a href="#Lumascope.set_auto_gain-232"><span class="linenos">232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.set_auto_gain-233"><a href="#Lumascope.set_auto_gain-233"><span class="linenos">233</span></a><span class="sd">        Enable / Disable camera auto_gain with the value of &#39;state&#39;</span>
</span><span id="Lumascope.set_auto_gain-234"><a href="#Lumascope.set_auto_gain-234"><span class="linenos">234</span></a><span class="sd">        It will be continueously updating based on the current image &quot;&quot;&quot;</span>
</span><span id="Lumascope.set_auto_gain-235"><a href="#Lumascope.set_auto_gain-235"><span class="linenos">235</span></a>
</span><span id="Lumascope.set_auto_gain-236"><a href="#Lumascope.set_auto_gain-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.set_auto_gain-237"><a href="#Lumascope.set_auto_gain-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">auto_gain</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Enable / Disable camera auto_gain with the value of 'state'
It will be continueously updating based on the current image</p>
</div>


                            </div>
                            <div id="Lumascope.set_exposure_time" class="classattr">
                                        <input id="Lumascope.set_exposure_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_exposure_time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.set_exposure_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.set_exposure_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.set_exposure_time-239"><a href="#Lumascope.set_exposure_time-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">set_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="Lumascope.set_exposure_time-240"><a href="#Lumascope.set_exposure_time-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.set_exposure_time-241"><a href="#Lumascope.set_exposure_time-241"><span class="linenos">241</span></a><span class="sd">         Set exposure time in the camera hardware t (msec)&quot;&quot;&quot;</span>
</span><span id="Lumascope.set_exposure_time-242"><a href="#Lumascope.set_exposure_time-242"><span class="linenos">242</span></a>
</span><span id="Lumascope.set_exposure_time-243"><a href="#Lumascope.set_exposure_time-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.set_exposure_time-244"><a href="#Lumascope.set_exposure_time-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">exposure_t</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Set exposure time in the camera hardware t (msec)</p>
</div>


                            </div>
                            <div id="Lumascope.get_exposure_time" class="classattr">
                                        <input id="Lumascope.get_exposure_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_exposure_time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_exposure_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_exposure_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_exposure_time-246"><a href="#Lumascope.get_exposure_time-246"><span class="linenos">246</span></a>    <span class="k">def</span> <span class="nf">get_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.get_exposure_time-247"><a href="#Lumascope.get_exposure_time-247"><span class="linenos">247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.get_exposure_time-248"><a href="#Lumascope.get_exposure_time-248"><span class="linenos">248</span></a><span class="sd">         Get exposure time in the camera hardware</span>
</span><span id="Lumascope.get_exposure_time-249"><a href="#Lumascope.get_exposure_time-249"><span class="linenos">249</span></a><span class="sd">         Returns t (msec), or -1 if the camera is inactive&quot;&quot;&quot;</span>
</span><span id="Lumascope.get_exposure_time-250"><a href="#Lumascope.get_exposure_time-250"><span class="linenos">250</span></a>
</span><span id="Lumascope.get_exposure_time-251"><a href="#Lumascope.get_exposure_time-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Lumascope.get_exposure_time-252"><a href="#Lumascope.get_exposure_time-252"><span class="linenos">252</span></a>        <span class="n">exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_exposure_t</span><span class="p">()</span>
</span><span id="Lumascope.get_exposure_time-253"><a href="#Lumascope.get_exposure_time-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="n">exposure</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
Get exposure time in the camera hardware
Returns t (msec), or -1 if the camera is inactive</p>
</div>


                            </div>
                            <div id="Lumascope.set_auto_exposure_time" class="classattr">
                                        <input id="Lumascope.set_auto_exposure_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_auto_exposure_time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.set_auto_exposure_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.set_auto_exposure_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.set_auto_exposure_time-255"><a href="#Lumascope.set_auto_exposure_time-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">set_auto_exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="Lumascope.set_auto_exposure_time-256"><a href="#Lumascope.set_auto_exposure_time-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;CAMERA FUNCTIONS</span>
</span><span id="Lumascope.set_auto_exposure_time-257"><a href="#Lumascope.set_auto_exposure_time-257"><span class="linenos">257</span></a><span class="sd">         Enable / Disable camera auto_exposure with the value of &#39;state&#39;</span>
</span><span id="Lumascope.set_auto_exposure_time-258"><a href="#Lumascope.set_auto_exposure_time-258"><span class="linenos">258</span></a><span class="sd">        It will be continueously updating based on the current image &quot;&quot;&quot;</span>
</span><span id="Lumascope.set_auto_exposure_time-259"><a href="#Lumascope.set_auto_exposure_time-259"><span class="linenos">259</span></a>
</span><span id="Lumascope.set_auto_exposure_time-260"><a href="#Lumascope.set_auto_exposure_time-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.set_auto_exposure_time-261"><a href="#Lumascope.set_auto_exposure_time-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">auto_exposure_t</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>CAMERA FUNCTIONS
 Enable / Disable camera auto_exposure with the value of 'state'
It will be continueously updating based on the current image</p>
</div>


                            </div>
                            <div id="Lumascope.zhome" class="classattr">
                                        <input id="Lumascope.zhome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zhome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.zhome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.zhome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.zhome-267"><a href="#Lumascope.zhome-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">zhome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.zhome-268"><a href="#Lumascope.zhome-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.zhome-269"><a href="#Lumascope.zhome-269"><span class="linenos">269</span></a><span class="sd">        Home the z-axis (i.e. focus)&quot;&quot;&quot;</span>
</span><span id="Lumascope.zhome-270"><a href="#Lumascope.zhome-270"><span class="linenos">270</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.zhome-271"><a href="#Lumascope.zhome-271"><span class="linenos">271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">zhome</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Home the z-axis (i.e. focus)</p>
</div>


                            </div>
                            <div id="Lumascope.xyhome" class="classattr">
                                        <input id="Lumascope.xyhome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">xyhome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.xyhome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.xyhome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.xyhome-273"><a href="#Lumascope.xyhome-273"><span class="linenos">273</span></a>    <span class="k">def</span> <span class="nf">xyhome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.xyhome-274"><a href="#Lumascope.xyhome-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.xyhome-275"><a href="#Lumascope.xyhome-275"><span class="linenos">275</span></a><span class="sd">        Home the xy-axes (i.e. stage). Note: z-axis and turret will always home first&quot;&quot;&quot;</span>
</span><span id="Lumascope.xyhome-276"><a href="#Lumascope.xyhome-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.xyhome-277"><a href="#Lumascope.xyhome-277"><span class="linenos">277</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">xyhome</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Home the xy-axes (i.e. stage). Note: z-axis and turret will always home first</p>
</div>


                            </div>
                            <div id="Lumascope.xycenter" class="classattr">
                                        <input id="Lumascope.xycenter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">xycenter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.xycenter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.xycenter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.xycenter-279"><a href="#Lumascope.xycenter-279"><span class="linenos">279</span></a>    <span class="k">def</span> <span class="nf">xycenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.xycenter-280"><a href="#Lumascope.xycenter-280"><span class="linenos">280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.xycenter-281"><a href="#Lumascope.xycenter-281"><span class="linenos">281</span></a><span class="sd">        Move Stage to the center.&quot;&quot;&quot;</span>
</span><span id="Lumascope.xycenter-282"><a href="#Lumascope.xycenter-282"><span class="linenos">282</span></a>
</span><span id="Lumascope.xycenter-283"><a href="#Lumascope.xycenter-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.xycenter-284"><a href="#Lumascope.xycenter-284"><span class="linenos">284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">xycenter</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Move Stage to the center.</p>
</div>


                            </div>
                            <div id="Lumascope.thome" class="classattr">
                                        <input id="Lumascope.thome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">thome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.thome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.thome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.thome-286"><a href="#Lumascope.thome-286"><span class="linenos">286</span></a>    <span class="k">def</span> <span class="nf">thome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.thome-287"><a href="#Lumascope.thome-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.thome-288"><a href="#Lumascope.thome-288"><span class="linenos">288</span></a><span class="sd">        Home the Turret&quot;&quot;&quot;</span>
</span><span id="Lumascope.thome-289"><a href="#Lumascope.thome-289"><span class="linenos">289</span></a>
</span><span id="Lumascope.thome-290"><a href="#Lumascope.thome-290"><span class="linenos">290</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.thome-291"><a href="#Lumascope.thome-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">thome</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Home the Turret</p>
</div>


                            </div>
                            <div id="Lumascope.get_target_position" class="classattr">
                                        <input id="Lumascope.get_target_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_target_position</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_target_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_target_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_target_position-293"><a href="#Lumascope.get_target_position-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">get_target_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope.get_target_position-294"><a href="#Lumascope.get_target_position-294"><span class="linenos">294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.get_target_position-295"><a href="#Lumascope.get_target_position-295"><span class="linenos">295</span></a><span class="sd">        Get the value of the target position of the axis relative to home</span>
</span><span id="Lumascope.get_target_position-296"><a href="#Lumascope.get_target_position-296"><span class="linenos">296</span></a><span class="sd">        Returns position (um), or 0 if the motion board is inactive</span>
</span><span id="Lumascope.get_target_position-297"><a href="#Lumascope.get_target_position-297"><span class="linenos">297</span></a><span class="sd">        values of axis &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, and &#39;T&#39; &quot;&quot;&quot;</span>
</span><span id="Lumascope.get_target_position-298"><a href="#Lumascope.get_target_position-298"><span class="linenos">298</span></a>
</span><span id="Lumascope.get_target_position-299"><a href="#Lumascope.get_target_position-299"><span class="linenos">299</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope.get_target_position-300"><a href="#Lumascope.get_target_position-300"><span class="linenos">300</span></a>        <span class="n">target_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">target_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope.get_target_position-301"><a href="#Lumascope.get_target_position-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="n">target_position</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Get the value of the target position of the axis relative to home
Returns position (um), or 0 if the motion board is inactive
values of axis 'X', 'Y', 'Z', and 'T'</p>
</div>


                            </div>
                            <div id="Lumascope.get_current_position" class="classattr">
                                        <input id="Lumascope.get_current_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_current_position</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_current_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_current_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_current_position-303"><a href="#Lumascope.get_current_position-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">get_current_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope.get_current_position-304"><a href="#Lumascope.get_current_position-304"><span class="linenos">304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.get_current_position-305"><a href="#Lumascope.get_current_position-305"><span class="linenos">305</span></a><span class="sd">        Get the value of the current position of the axis relative to home</span>
</span><span id="Lumascope.get_current_position-306"><a href="#Lumascope.get_current_position-306"><span class="linenos">306</span></a><span class="sd">        Returns position (um), or 0 if the motion board is inactive</span>
</span><span id="Lumascope.get_current_position-307"><a href="#Lumascope.get_current_position-307"><span class="linenos">307</span></a><span class="sd">        values of axis &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, and &#39;T&#39; &quot;&quot;&quot;</span>
</span><span id="Lumascope.get_current_position-308"><a href="#Lumascope.get_current_position-308"><span class="linenos">308</span></a>
</span><span id="Lumascope.get_current_position-309"><a href="#Lumascope.get_current_position-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="Lumascope.get_current_position-310"><a href="#Lumascope.get_current_position-310"><span class="linenos">310</span></a>        <span class="n">target_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">current_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope.get_current_position-311"><a href="#Lumascope.get_current_position-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="n">target_position</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Get the value of the current position of the axis relative to home
Returns position (um), or 0 if the motion board is inactive
values of axis 'X', 'Y', 'Z', and 'T'</p>
</div>


                            </div>
                            <div id="Lumascope.move_absolute_position" class="classattr">
                                        <input id="Lumascope.move_absolute_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_absolute_position</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis</span>, </span><span class="param"><span class="n">pos</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.move_absolute_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.move_absolute_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.move_absolute_position-313"><a href="#Lumascope.move_absolute_position-313"><span class="linenos">313</span></a>    <span class="k">def</span> <span class="nf">move_absolute_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
</span><span id="Lumascope.move_absolute_position-314"><a href="#Lumascope.move_absolute_position-314"><span class="linenos">314</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.move_absolute_position-315"><a href="#Lumascope.move_absolute_position-315"><span class="linenos">315</span></a><span class="sd">         Move to absolute position (in um) of axis&quot;&quot;&quot;</span>
</span><span id="Lumascope.move_absolute_position-316"><a href="#Lumascope.move_absolute_position-316"><span class="linenos">316</span></a>
</span><span id="Lumascope.move_absolute_position-317"><a href="#Lumascope.move_absolute_position-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.move_absolute_position-318"><a href="#Lumascope.move_absolute_position-318"><span class="linenos">318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">move_abs_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Move to absolute position (in um) of axis</p>
</div>


                            </div>
                            <div id="Lumascope.move_relative_position" class="classattr">
                                        <input id="Lumascope.move_relative_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_relative_position</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis</span>, </span><span class="param"><span class="n">um</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.move_relative_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.move_relative_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.move_relative_position-320"><a href="#Lumascope.move_relative_position-320"><span class="linenos">320</span></a>    <span class="k">def</span> <span class="nf">move_relative_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">um</span><span class="p">):</span>
</span><span id="Lumascope.move_relative_position-321"><a href="#Lumascope.move_relative_position-321"><span class="linenos">321</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.move_relative_position-322"><a href="#Lumascope.move_relative_position-322"><span class="linenos">322</span></a><span class="sd">         Move to relative distance (in um) of axis&quot;&quot;&quot;</span>
</span><span id="Lumascope.move_relative_position-323"><a href="#Lumascope.move_relative_position-323"><span class="linenos">323</span></a>
</span><span id="Lumascope.move_relative_position-324"><a href="#Lumascope.move_relative_position-324"><span class="linenos">324</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span>
</span><span id="Lumascope.move_relative_position-325"><a href="#Lumascope.move_relative_position-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">move_rel_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">um</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Move to relative distance (in um) of axis</p>
</div>


                            </div>
                            <div id="Lumascope.get_home_status" class="classattr">
                                        <input id="Lumascope.get_home_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_home_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_home_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_home_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_home_status-327"><a href="#Lumascope.get_home_status-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">get_home_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope.get_home_status-328"><a href="#Lumascope.get_home_status-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.get_home_status-329"><a href="#Lumascope.get_home_status-329"><span class="linenos">329</span></a><span class="sd">         Return True if axis is in home position&quot;&quot;&quot;</span>
</span><span id="Lumascope.get_home_status-330"><a href="#Lumascope.get_home_status-330"><span class="linenos">330</span></a> 
</span><span id="Lumascope.get_home_status-331"><a href="#Lumascope.get_home_status-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope.get_home_status-332"><a href="#Lumascope.get_home_status-332"><span class="linenos">332</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">home_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope.get_home_status-333"><a href="#Lumascope.get_home_status-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="n">status</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Return True if axis is in home position</p>
</div>


                            </div>
                            <div id="Lumascope.get_target_status" class="classattr">
                                        <input id="Lumascope.get_target_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_target_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_target_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_target_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_target_status-335"><a href="#Lumascope.get_target_status-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="nf">get_target_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope.get_target_status-336"><a href="#Lumascope.get_target_status-336"><span class="linenos">336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.get_target_status-337"><a href="#Lumascope.get_target_status-337"><span class="linenos">337</span></a><span class="sd">         Return True if axis is at target position&quot;&quot;&quot;</span>
</span><span id="Lumascope.get_target_status-338"><a href="#Lumascope.get_target_status-338"><span class="linenos">338</span></a>
</span><span id="Lumascope.get_target_status-339"><a href="#Lumascope.get_target_status-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope.get_target_status-340"><a href="#Lumascope.get_target_status-340"><span class="linenos">340</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">target_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope.get_target_status-341"><a href="#Lumascope.get_target_status-341"><span class="linenos">341</span></a>        <span class="k">return</span> <span class="n">status</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Return True if axis is at target position</p>
</div>


                            </div>
                            <div id="Lumascope.get_reference_status" class="classattr">
                                        <input id="Lumascope.get_reference_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_reference_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_reference_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_reference_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_reference_status-344"><a href="#Lumascope.get_reference_status-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">get_reference_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
</span><span id="Lumascope.get_reference_status-345"><a href="#Lumascope.get_reference_status-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.get_reference_status-346"><a href="#Lumascope.get_reference_status-346"><span class="linenos">346</span></a><span class="sd">         Get all reference status register bits as 32 character string (32-&gt; 0) &quot;&quot;&quot;</span>
</span><span id="Lumascope.get_reference_status-347"><a href="#Lumascope.get_reference_status-347"><span class="linenos">347</span></a>
</span><span id="Lumascope.get_reference_status-348"><a href="#Lumascope.get_reference_status-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope.get_reference_status-349"><a href="#Lumascope.get_reference_status-349"><span class="linenos">349</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">reference_status</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="Lumascope.get_reference_status-350"><a href="#Lumascope.get_reference_status-350"><span class="linenos">350</span></a>        <span class="k">return</span> <span class="n">status</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Get all reference status register bits as 32 character string (32-> 0)</p>
</div>


                            </div>
                            <div id="Lumascope.get_overshoot" class="classattr">
                                        <input id="Lumascope.get_overshoot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_overshoot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.get_overshoot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.get_overshoot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.get_overshoot-352"><a href="#Lumascope.get_overshoot-352"><span class="linenos">352</span></a>    <span class="k">def</span> <span class="nf">get_overshoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Lumascope.get_overshoot-353"><a href="#Lumascope.get_overshoot-353"><span class="linenos">353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;MOTION CONTROL FUNCTIONS</span>
</span><span id="Lumascope.get_overshoot-354"><a href="#Lumascope.get_overshoot-354"><span class="linenos">354</span></a><span class="sd">        Is z-axis (focus) currently in overshoot mode?&quot;&quot;&quot;</span>
</span><span id="Lumascope.get_overshoot-355"><a href="#Lumascope.get_overshoot-355"><span class="linenos">355</span></a>
</span><span id="Lumascope.get_overshoot-356"><a href="#Lumascope.get_overshoot-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="Lumascope.get_overshoot-357"><a href="#Lumascope.get_overshoot-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">overshoot</span>
</span></pre></div>


            <div class="docstring"><p>MOTION CONTROL FUNCTIONS
Is z-axis (focus) currently in overshoot mode?</p>
</div>


                            </div>
                            <div id="Lumascope.autofocus" class="classattr">
                                        <input id="Lumascope.autofocus-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">autofocus</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dt</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.autofocus-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.autofocus"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.autofocus-364"><a href="#Lumascope.autofocus-364"><span class="linenos">364</span></a>    <span class="k">def</span> <span class="nf">autofocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="Lumascope.autofocus-365"><a href="#Lumascope.autofocus-365"><span class="linenos">365</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="Lumascope.autofocus-366"><a href="#Lumascope.autofocus-366"><span class="linenos">366</span></a><span class="sd">        begin autofocus functionality (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="Lumascope.autofocus-367"><a href="#Lumascope.autofocus-367"><span class="linenos">367</span></a>        
</span><span id="Lumascope.autofocus-368"><a href="#Lumascope.autofocus-368"><span class="linenos">368</span></a>        <span class="c1"># These should be passed but its not working</span>
</span><span id="Lumascope.autofocus-369"><a href="#Lumascope.autofocus-369"><span class="linenos">369</span></a>        <span class="n">AF_range</span> <span class="o">=</span> <span class="mf">15.0</span>
</span><span id="Lumascope.autofocus-370"><a href="#Lumascope.autofocus-370"><span class="linenos">370</span></a>        <span class="n">AF_min</span> <span class="o">=</span>   <span class="mf">0.5</span>
</span><span id="Lumascope.autofocus-371"><a href="#Lumascope.autofocus-371"><span class="linenos">371</span></a>        <span class="n">AF_max</span> <span class="o">=</span>   <span class="mf">6.0</span>
</span><span id="Lumascope.autofocus-372"><a href="#Lumascope.autofocus-372"><span class="linenos">372</span></a>        
</span><span id="Lumascope.autofocus-373"><a href="#Lumascope.autofocus-373"><span class="linenos">373</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Lumascope.autofocus()&#39;</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-374"><a href="#Lumascope.autofocus-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_complete</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Lumascope.autofocus-375"><a href="#Lumascope.autofocus-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Lumascope.autofocus-376"><a href="#Lumascope.autofocus-376"><span class="linenos">376</span></a>
</span><span id="Lumascope.autofocus-377"><a href="#Lumascope.autofocus-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-378"><a href="#Lumascope.autofocus-378"><span class="linenos">378</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Error: VerticalControl.autofocus()&#39;</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-379"><a href="#Lumascope.autofocus-379"><span class="linenos">379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Lumascope.autofocus-380"><a href="#Lumascope.autofocus-380"><span class="linenos">380</span></a>            <span class="k">return</span>
</span><span id="Lumascope.autofocus-381"><a href="#Lumascope.autofocus-381"><span class="linenos">381</span></a>
</span><span id="Lumascope.autofocus-382"><a href="#Lumascope.autofocus-382"><span class="linenos">382</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-383"><a href="#Lumascope.autofocus-383"><span class="linenos">383</span></a>
</span><span id="Lumascope.autofocus-384"><a href="#Lumascope.autofocus-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span><span class="o">-</span><span class="n">AF_range</span><span class="p">)</span>      <span class="c1"># starting minimum z-height for autofocus</span>
</span><span id="Lumascope.autofocus-385"><a href="#Lumascope.autofocus-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">center</span><span class="o">+</span><span class="n">AF_range</span>              <span class="c1"># starting maximum z-height for autofocus</span>
</span><span id="Lumascope.autofocus-386"><a href="#Lumascope.autofocus-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">AF_max</span>                  <span class="c1"># starting step size for autofocus</span>
</span><span id="Lumascope.autofocus-387"><a href="#Lumascope.autofocus-387"><span class="linenos">387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exposure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exposure_time</span><span class="p">()</span>  <span class="c1"># camera exposure to determine &#39;wait&#39; time</span>
</span><span id="Lumascope.autofocus-388"><a href="#Lumascope.autofocus-388"><span class="linenos">388</span></a>
</span><span id="Lumascope.autofocus-389"><a href="#Lumascope.autofocus-389"><span class="linenos">389</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># List of positions to step through</span>
</span><span id="Lumascope.autofocus-390"><a href="#Lumascope.autofocus-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Measure focus score at each position</span>
</span><span id="Lumascope.autofocus-391"><a href="#Lumascope.autofocus-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_focus</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># Last / Previous focus score</span>
</span><span id="Lumascope.autofocus-392"><a href="#Lumascope.autofocus-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">False</span>         <span class="c1"># Are we on the last scan for autofocus?</span>
</span><span id="Lumascope.autofocus-393"><a href="#Lumascope.autofocus-393"><span class="linenos">393</span></a>
</span><span id="Lumascope.autofocus-394"><a href="#Lumascope.autofocus-394"><span class="linenos">394</span></a>        <span class="c1"># Start the autofocus process at z-minimum</span>
</span><span id="Lumascope.autofocus-395"><a href="#Lumascope.autofocus-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-396"><a href="#Lumascope.autofocus-396"><span class="linenos">396</span></a>
</span><span id="Lumascope.autofocus-397"><a href="#Lumascope.autofocus-397"><span class="linenos">397</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-398"><a href="#Lumascope.autofocus-398"><span class="linenos">398</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-399"><a href="#Lumascope.autofocus-399"><span class="linenos">399</span></a>
</span><span id="Lumascope.autofocus-400"><a href="#Lumascope.autofocus-400"><span class="linenos">400</span></a>            <span class="c1"># If the z-height has reached its target</span>
</span><span id="Lumascope.autofocus-401"><a href="#Lumascope.autofocus-401"><span class="linenos">401</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_status</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_overshoot</span><span class="p">():</span>
</span><span id="Lumascope.autofocus-402"><a href="#Lumascope.autofocus-402"><span class="linenos">402</span></a>                
</span><span id="Lumascope.autofocus-403"><a href="#Lumascope.autofocus-403"><span class="linenos">403</span></a>                <span class="c1"># Wait two exposure lengths</span>
</span><span id="Lumascope.autofocus-404"><a href="#Lumascope.autofocus-404"><span class="linenos">404</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exposure</span><span class="o">/</span><span class="mi">1000</span><span class="o">+</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># msec into sec</span>
</span><span id="Lumascope.autofocus-405"><a href="#Lumascope.autofocus-405"><span class="linenos">405</span></a>
</span><span id="Lumascope.autofocus-406"><a href="#Lumascope.autofocus-406"><span class="linenos">406</span></a>                <span class="c1"># observe the image </span>
</span><span id="Lumascope.autofocus-407"><a href="#Lumascope.autofocus-407"><span class="linenos">407</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
</span><span id="Lumascope.autofocus-408"><a href="#Lumascope.autofocus-408"><span class="linenos">408</span></a>                <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Lumascope.autofocus-409"><a href="#Lumascope.autofocus-409"><span class="linenos">409</span></a>
</span><span id="Lumascope.autofocus-410"><a href="#Lumascope.autofocus-410"><span class="linenos">410</span></a>                <span class="c1"># Use center quarter of image for focusing</span>
</span><span id="Lumascope.autofocus-411"><a href="#Lumascope.autofocus-411"><span class="linenos">411</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rows</span><span class="o">/</span><span class="mi">4</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">rows</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">cols</span><span class="o">/</span><span class="mi">4</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">cols</span><span class="o">/</span><span class="mi">4</span><span class="p">)]</span>
</span><span id="Lumascope.autofocus-412"><a href="#Lumascope.autofocus-412"><span class="linenos">412</span></a>
</span><span id="Lumascope.autofocus-413"><a href="#Lumascope.autofocus-413"><span class="linenos">413</span></a>                <span class="c1"># calculate the position and focus measure</span>
</span><span id="Lumascope.autofocus-414"><a href="#Lumascope.autofocus-414"><span class="linenos">414</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-415"><a href="#Lumascope.autofocus-415"><span class="linenos">415</span></a>                    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-416"><a href="#Lumascope.autofocus-416"><span class="linenos">416</span></a>                    <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_function</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-417"><a href="#Lumascope.autofocus-417"><span class="linenos">417</span></a>                    <span class="n">next_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="Lumascope.autofocus-418"><a href="#Lumascope.autofocus-418"><span class="linenos">418</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-419"><a href="#Lumascope.autofocus-419"><span class="linenos">419</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SCOPE API ] Error talking to motion controller.&#39;</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-420"><a href="#Lumascope.autofocus-420"><span class="linenos">420</span></a>                    <span class="k">raise</span>
</span><span id="Lumascope.autofocus-421"><a href="#Lumascope.autofocus-421"><span class="linenos">421</span></a>
</span><span id="Lumascope.autofocus-422"><a href="#Lumascope.autofocus-422"><span class="linenos">422</span></a>                <span class="c1"># append to positions and focus measures</span>
</span><span id="Lumascope.autofocus-423"><a href="#Lumascope.autofocus-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-424"><a href="#Lumascope.autofocus-424"><span class="linenos">424</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">focus</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-425"><a href="#Lumascope.autofocus-425"><span class="linenos">425</span></a>
</span><span id="Lumascope.autofocus-426"><a href="#Lumascope.autofocus-426"><span class="linenos">426</span></a>                <span class="c1"># if (focus &lt; self.last_focus) or (next_target &gt; self.z_max):</span>
</span><span id="Lumascope.autofocus-427"><a href="#Lumascope.autofocus-427"><span class="linenos">427</span></a>                <span class="k">if</span> <span class="n">next_target</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-428"><a href="#Lumascope.autofocus-428"><span class="linenos">428</span></a>
</span><span id="Lumascope.autofocus-429"><a href="#Lumascope.autofocus-429"><span class="linenos">429</span></a>                    <span class="c1"># Calculate new step size for resolution</span>
</span><span id="Lumascope.autofocus-430"><a href="#Lumascope.autofocus-430"><span class="linenos">430</span></a>                    <span class="n">prev_resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
</span><span id="Lumascope.autofocus-431"><a href="#Lumascope.autofocus-431"><span class="linenos">431</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">prev_resolution</span> <span class="o">/</span> <span class="mi">3</span> <span class="c1"># SELECT DESIRED RESOLUTION FRACTION</span>
</span><span id="Lumascope.autofocus-432"><a href="#Lumascope.autofocus-432"><span class="linenos">432</span></a>
</span><span id="Lumascope.autofocus-433"><a href="#Lumascope.autofocus-433"><span class="linenos">433</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">&lt;</span> <span class="n">AF_min</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-434"><a href="#Lumascope.autofocus-434"><span class="linenos">434</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">AF_min</span>
</span><span id="Lumascope.autofocus-435"><a href="#Lumascope.autofocus-435"><span class="linenos">435</span></a>
</span><span id="Lumascope.autofocus-436"><a href="#Lumascope.autofocus-436"><span class="linenos">436</span></a>                    <span class="c1"># As long as the step size is larger than or equal to the minimum and not the last pass</span>
</span><span id="Lumascope.autofocus-437"><a href="#Lumascope.autofocus-437"><span class="linenos">437</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">&gt;=</span> <span class="n">AF_min</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-438"><a href="#Lumascope.autofocus-438"><span class="linenos">438</span></a>
</span><span id="Lumascope.autofocus-439"><a href="#Lumascope.autofocus-439"><span class="linenos">439</span></a>                        <span class="c1"># compute best focus</span>
</span><span id="Lumascope.autofocus-440"><a href="#Lumascope.autofocus-440"><span class="linenos">440</span></a>                        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-441"><a href="#Lumascope.autofocus-441"><span class="linenos">441</span></a>
</span><span id="Lumascope.autofocus-442"><a href="#Lumascope.autofocus-442"><span class="linenos">442</span></a>                        <span class="c1"># assign new z_min, z_max, resolution, and sweep</span>
</span><span id="Lumascope.autofocus-443"><a href="#Lumascope.autofocus-443"><span class="linenos">443</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="n">focus</span><span class="o">-</span><span class="n">prev_resolution</span> 
</span><span id="Lumascope.autofocus-444"><a href="#Lumascope.autofocus-444"><span class="linenos">444</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">focus</span><span class="o">+</span><span class="n">prev_resolution</span> 
</span><span id="Lumascope.autofocus-445"><a href="#Lumascope.autofocus-445"><span class="linenos">445</span></a>
</span><span id="Lumascope.autofocus-446"><a href="#Lumascope.autofocus-446"><span class="linenos">446</span></a>                        <span class="c1"># reset positions and focus measures</span>
</span><span id="Lumascope.autofocus-447"><a href="#Lumascope.autofocus-447"><span class="linenos">447</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Lumascope.autofocus-448"><a href="#Lumascope.autofocus-448"><span class="linenos">448</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Lumascope.autofocus-449"><a href="#Lumascope.autofocus-449"><span class="linenos">449</span></a>
</span><span id="Lumascope.autofocus-450"><a href="#Lumascope.autofocus-450"><span class="linenos">450</span></a>                        <span class="c1"># go to new z_min</span>
</span><span id="Lumascope.autofocus-451"><a href="#Lumascope.autofocus-451"><span class="linenos">451</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-452"><a href="#Lumascope.autofocus-452"><span class="linenos">452</span></a>
</span><span id="Lumascope.autofocus-453"><a href="#Lumascope.autofocus-453"><span class="linenos">453</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">==</span> <span class="n">AF_min</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-454"><a href="#Lumascope.autofocus-454"><span class="linenos">454</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Lumascope.autofocus-455"><a href="#Lumascope.autofocus-455"><span class="linenos">455</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.last = True&#39;</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-456"><a href="#Lumascope.autofocus-456"><span class="linenos">456</span></a>                    <span class="k">else</span><span class="p">:</span> <span class="c1"># self.resolution &gt;= AF_min and not self.last</span>
</span><span id="Lumascope.autofocus-457"><a href="#Lumascope.autofocus-457"><span class="linenos">457</span></a>                        <span class="c1"># compute best focus</span>
</span><span id="Lumascope.autofocus-458"><a href="#Lumascope.autofocus-458"><span class="linenos">458</span></a>                        <span class="n">focus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_measures</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-459"><a href="#Lumascope.autofocus-459"><span class="linenos">459</span></a>                        
</span><span id="Lumascope.autofocus-460"><a href="#Lumascope.autofocus-460"><span class="linenos">460</span></a>                        <span class="c1"># go to best focus</span>
</span><span id="Lumascope.autofocus-461"><a href="#Lumascope.autofocus-461"><span class="linenos">461</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">move_absolute_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">focus</span><span class="p">)</span> <span class="c1"># move to absolute target</span>
</span><span id="Lumascope.autofocus-462"><a href="#Lumascope.autofocus-462"><span class="linenos">462</span></a>                        
</span><span id="Lumascope.autofocus-463"><a href="#Lumascope.autofocus-463"><span class="linenos">463</span></a>                        <span class="c1"># end autofocus sequence</span>
</span><span id="Lumascope.autofocus-464"><a href="#Lumascope.autofocus-464"><span class="linenos">464</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">is_autofocus</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Lumascope.autofocus-465"><a href="#Lumascope.autofocus-465"><span class="linenos">465</span></a>                        
</span><span id="Lumascope.autofocus-466"><a href="#Lumascope.autofocus-466"><span class="linenos">466</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">is_complete</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Lumascope.autofocus-467"><a href="#Lumascope.autofocus-467"><span class="linenos">467</span></a>
</span><span id="Lumascope.autofocus-468"><a href="#Lumascope.autofocus-468"><span class="linenos">468</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope.autofocus-469"><a href="#Lumascope.autofocus-469"><span class="linenos">469</span></a>                    <span class="c1"># move to next position</span>
</span><span id="Lumascope.autofocus-470"><a href="#Lumascope.autofocus-470"><span class="linenos">470</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">move_relative_position</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="Lumascope.autofocus-471"><a href="#Lumascope.autofocus-471"><span class="linenos">471</span></a>
</span><span id="Lumascope.autofocus-472"><a href="#Lumascope.autofocus-472"><span class="linenos">472</span></a>                <span class="c1"># update last focus</span>
</span><span id="Lumascope.autofocus-473"><a href="#Lumascope.autofocus-473"><span class="linenos">473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_focus</span> <span class="o">=</span> <span class="n">focus</span>
</span></pre></div>


            <div class="docstring"><p>INTEGRATED SCOPE FUNCTIONS
begin autofocus functionality (not yet ported from LVP)</p>
</div>


                            </div>
                            <div id="Lumascope.focus_function" class="classattr">
                                        <input id="Lumascope.focus_function-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">focus_function</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">image</span>, </span><span class="param"><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;vollath4&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.focus_function-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.focus_function"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.focus_function-476"><a href="#Lumascope.focus_function-476"><span class="linenos">476</span></a>    <span class="k">def</span> <span class="nf">focus_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s1">&#39;vollath4&#39;</span><span class="p">):</span>
</span><span id="Lumascope.focus_function-477"><a href="#Lumascope.focus_function-477"><span class="linenos">477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="Lumascope.focus_function-478"><a href="#Lumascope.focus_function-478"><span class="linenos">478</span></a><span class="sd">        assess focus value at specific position for autofocus function</span>
</span><span id="Lumascope.focus_function-479"><a href="#Lumascope.focus_function-479"><span class="linenos">479</span></a><span class="sd">        (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="Lumascope.focus_function-480"><a href="#Lumascope.focus_function-480"><span class="linenos">480</span></a>
</span><span id="Lumascope.focus_function-481"><a href="#Lumascope.focus_function-481"><span class="linenos">481</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] VerticalControl.focus_function()&#39;</span><span class="p">)</span>
</span><span id="Lumascope.focus_function-482"><a href="#Lumascope.focus_function-482"><span class="linenos">482</span></a>        <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Lumascope.focus_function-483"><a href="#Lumascope.focus_function-483"><span class="linenos">483</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Lumascope.focus_function-484"><a href="#Lumascope.focus_function-484"><span class="linenos">484</span></a>
</span><span id="Lumascope.focus_function-485"><a href="#Lumascope.focus_function-485"><span class="linenos">485</span></a>        <span class="c1"># Journal of Microscopy, Vol. 188, Pt 3, December 1997, pp. 264–272</span>
</span><span id="Lumascope.focus_function-486"><a href="#Lumascope.focus_function-486"><span class="linenos">486</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;vollath4&#39;</span><span class="p">:</span> <span class="c1"># pg 266</span>
</span><span id="Lumascope.focus_function-487"><a href="#Lumascope.focus_function-487"><span class="linenos">487</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="Lumascope.focus_function-488"><a href="#Lumascope.focus_function-488"><span class="linenos">488</span></a>            <span class="n">sum_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">image</span><span class="p">[:</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="n">h</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">w</span><span class="p">,:</span><span class="n">h</span><span class="p">]))</span> <span class="c1"># g(i, j).g(i+1, j)</span>
</span><span id="Lumascope.focus_function-489"><a href="#Lumascope.focus_function-489"><span class="linenos">489</span></a>            <span class="n">sum_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">image</span><span class="p">[:</span><span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">,:</span><span class="n">h</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">w</span><span class="p">,:</span><span class="n">h</span><span class="p">]))</span> <span class="c1"># g(i, j).g(i+2, j)</span>
</span><span id="Lumascope.focus_function-490"><a href="#Lumascope.focus_function-490"><span class="linenos">490</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Vollath: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sum_one</span> <span class="o">-</span> <span class="n">sum_two</span><span class="p">))</span>
</span><span id="Lumascope.focus_function-491"><a href="#Lumascope.focus_function-491"><span class="linenos">491</span></a>            <span class="k">return</span> <span class="n">sum_one</span> <span class="o">-</span> <span class="n">sum_two</span>
</span><span id="Lumascope.focus_function-492"><a href="#Lumascope.focus_function-492"><span class="linenos">492</span></a>
</span><span id="Lumascope.focus_function-493"><a href="#Lumascope.focus_function-493"><span class="linenos">493</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;skew&#39;</span><span class="p">:</span>
</span><span id="Lumascope.focus_function-494"><a href="#Lumascope.focus_function-494"><span class="linenos">494</span></a>            <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">))</span>
</span><span id="Lumascope.focus_function-495"><a href="#Lumascope.focus_function-495"><span class="linenos">495</span></a>            <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="Lumascope.focus_function-496"><a href="#Lumascope.focus_function-496"><span class="linenos">496</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="Lumascope.focus_function-497"><a href="#Lumascope.focus_function-497"><span class="linenos">497</span></a>
</span><span id="Lumascope.focus_function-498"><a href="#Lumascope.focus_function-498"><span class="linenos">498</span></a>            <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Lumascope.focus_function-499"><a href="#Lumascope.focus_function-499"><span class="linenos">499</span></a>            <span class="n">white_edge</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Lumascope.focus_function-500"><a href="#Lumascope.focus_function-500"><span class="linenos">500</span></a>
</span><span id="Lumascope.focus_function-501"><a href="#Lumascope.focus_function-501"><span class="linenos">501</span></a>            <span class="n">skew</span> <span class="o">=</span> <span class="n">white_edge</span><span class="o">-</span><span class="n">max_index</span>
</span><span id="Lumascope.focus_function-502"><a href="#Lumascope.focus_function-502"><span class="linenos">502</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Skew: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">skew</span><span class="p">))</span>
</span><span id="Lumascope.focus_function-503"><a href="#Lumascope.focus_function-503"><span class="linenos">503</span></a>            <span class="k">return</span> <span class="n">skew</span>
</span><span id="Lumascope.focus_function-504"><a href="#Lumascope.focus_function-504"><span class="linenos">504</span></a>
</span><span id="Lumascope.focus_function-505"><a href="#Lumascope.focus_function-505"><span class="linenos">505</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;pixel_variation&#39;</span><span class="p">:</span>
</span><span id="Lumascope.focus_function-506"><a href="#Lumascope.focus_function-506"><span class="linenos">506</span></a>            <span class="nb">sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="Lumascope.focus_function-507"><a href="#Lumascope.focus_function-507"><span class="linenos">507</span></a>            <span class="n">ssq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
</span><span id="Lumascope.focus_function-508"><a href="#Lumascope.focus_function-508"><span class="linenos">508</span></a>            <span class="n">var</span> <span class="o">=</span> <span class="n">ssq</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="nb">sum</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Lumascope.focus_function-509"><a href="#Lumascope.focus_function-509"><span class="linenos">509</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] Focus Score Pixel Variation: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
</span><span id="Lumascope.focus_function-510"><a href="#Lumascope.focus_function-510"><span class="linenos">510</span></a>            <span class="k">return</span> <span class="n">var</span>
</span><span id="Lumascope.focus_function-511"><a href="#Lumascope.focus_function-511"><span class="linenos">511</span></a><span class="w">        </span>
</span><span id="Lumascope.focus_function-512"><a href="#Lumascope.focus_function-512"><span class="linenos">512</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Lumascope.focus_function-513"><a href="#Lumascope.focus_function-513"><span class="linenos">513</span></a><span class="sd">        elif algorithm == &#39;convolve2D&#39;:</span>
</span><span id="Lumascope.focus_function-514"><a href="#Lumascope.focus_function-514"><span class="linenos">514</span></a><span class="sd">            # Bueno-Ibarra et al. Optical Engineering 44(6), 063601 (June 2005)</span>
</span><span id="Lumascope.focus_function-515"><a href="#Lumascope.focus_function-515"><span class="linenos">515</span></a><span class="sd">            kernel = np.array([ [0, -1, 0],</span>
</span><span id="Lumascope.focus_function-516"><a href="#Lumascope.focus_function-516"><span class="linenos">516</span></a><span class="sd">                                [-1, 4,-1],</span>
</span><span id="Lumascope.focus_function-517"><a href="#Lumascope.focus_function-517"><span class="linenos">517</span></a><span class="sd">                                [0, -1, 0]], dtype=&#39;float&#39;) / 6</span>
</span><span id="Lumascope.focus_function-518"><a href="#Lumascope.focus_function-518"><span class="linenos">518</span></a><span class="sd">            n = 9</span>
</span><span id="Lumascope.focus_function-519"><a href="#Lumascope.focus_function-519"><span class="linenos">519</span></a><span class="sd">            a = 1</span>
</span><span id="Lumascope.focus_function-520"><a href="#Lumascope.focus_function-520"><span class="linenos">520</span></a><span class="sd">            kernel = np.zeros([n,n])</span>
</span><span id="Lumascope.focus_function-521"><a href="#Lumascope.focus_function-521"><span class="linenos">521</span></a><span class="sd">            for i in range(n):</span>
</span><span id="Lumascope.focus_function-522"><a href="#Lumascope.focus_function-522"><span class="linenos">522</span></a><span class="sd">                for j in range(n):</span>
</span><span id="Lumascope.focus_function-523"><a href="#Lumascope.focus_function-523"><span class="linenos">523</span></a><span class="sd">                    r2 = ((i-(n-1)/2)**2 + (j-(n-1)/2)**2)/a**2</span>
</span><span id="Lumascope.focus_function-524"><a href="#Lumascope.focus_function-524"><span class="linenos">524</span></a><span class="sd">                    kernel[i,j] = 2*(1-r2)*np.exp(-0.5*r2)/np.sqrt(3*a)</span>
</span><span id="Lumascope.focus_function-525"><a href="#Lumascope.focus_function-525"><span class="linenos">525</span></a><span class="sd">            print(&#39;[LVP Main  ] kernel\t&#39; + str(kernel))</span>
</span><span id="Lumascope.focus_function-526"><a href="#Lumascope.focus_function-526"><span class="linenos">526</span></a><span class="sd">            convolve = signal.convolve2d(image, kernel, mode=&#39;valid&#39;)</span>
</span><span id="Lumascope.focus_function-527"><a href="#Lumascope.focus_function-527"><span class="linenos">527</span></a><span class="sd">            sum = np.sum(convolve)</span>
</span><span id="Lumascope.focus_function-528"><a href="#Lumascope.focus_function-528"><span class="linenos">528</span></a><span class="sd">            print(&#39;[LVP Main  ] sum\t&#39; + str(sum))</span>
</span><span id="Lumascope.focus_function-529"><a href="#Lumascope.focus_function-529"><span class="linenos">529</span></a><span class="sd">            return sum</span>
</span><span id="Lumascope.focus_function-530"><a href="#Lumascope.focus_function-530"><span class="linenos">530</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="Lumascope.focus_function-531"><a href="#Lumascope.focus_function-531"><span class="linenos">531</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope.focus_function-532"><a href="#Lumascope.focus_function-532"><span class="linenos">532</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>INTEGRATED SCOPE FUNCTIONS
assess focus value at specific position for autofocus function
(not yet ported from LVP)</p>
</div>


                            </div>
                            <div id="Lumascope.focus_best" class="classattr">
                                        <input id="Lumascope.focus_best-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">focus_best</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">positions</span>, </span><span class="param"><span class="n">values</span>, </span><span class="param"><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Lumascope.focus_best-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Lumascope.focus_best"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Lumascope.focus_best-534"><a href="#Lumascope.focus_best-534"><span class="linenos">534</span></a>    <span class="k">def</span> <span class="nf">focus_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">):</span>
</span><span id="Lumascope.focus_best-535"><a href="#Lumascope.focus_best-535"><span class="linenos">535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;INTEGRATED SCOPE FUNCTIONS</span>
</span><span id="Lumascope.focus_best-536"><a href="#Lumascope.focus_best-536"><span class="linenos">536</span></a><span class="sd">        select best focus position for autofocus function</span>
</span><span id="Lumascope.focus_best-537"><a href="#Lumascope.focus_best-537"><span class="linenos">537</span></a><span class="sd">        (not yet ported from LVP)&quot;&quot;&quot;</span>
</span><span id="Lumascope.focus_best-538"><a href="#Lumascope.focus_best-538"><span class="linenos">538</span></a>
</span><span id="Lumascope.focus_best-539"><a href="#Lumascope.focus_best-539"><span class="linenos">539</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[LVP Main  ] VerticalControl.focus_best()&#39;</span><span class="p">)</span>
</span><span id="Lumascope.focus_best-540"><a href="#Lumascope.focus_best-540"><span class="linenos">540</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;direct&#39;</span><span class="p">:</span>
</span><span id="Lumascope.focus_best-541"><a href="#Lumascope.focus_best-541"><span class="linenos">541</span></a>            <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="Lumascope.focus_best-542"><a href="#Lumascope.focus_best-542"><span class="linenos">542</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span>
</span><span id="Lumascope.focus_best-543"><a href="#Lumascope.focus_best-543"><span class="linenos">543</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>
</span><span id="Lumascope.focus_best-544"><a href="#Lumascope.focus_best-544"><span class="linenos">544</span></a>
</span><span id="Lumascope.focus_best-545"><a href="#Lumascope.focus_best-545"><span class="linenos">545</span></a>        <span class="k">elif</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s1">&#39;mov_avg&#39;</span><span class="p">:</span>
</span><span id="Lumascope.focus_best-546"><a href="#Lumascope.focus_best-546"><span class="linenos">546</span></a>            <span class="n">avg_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
</span><span id="Lumascope.focus_best-547"><a href="#Lumascope.focus_best-547"><span class="linenos">547</span></a>            <span class="n">max_index</span> <span class="o">=</span> <span class="n">avg_values</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</span><span id="Lumascope.focus_best-548"><a href="#Lumascope.focus_best-548"><span class="linenos">548</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>
</span><span id="Lumascope.focus_best-549"><a href="#Lumascope.focus_best-549"><span class="linenos">549</span></a>
</span><span id="Lumascope.focus_best-550"><a href="#Lumascope.focus_best-550"><span class="linenos">550</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Lumascope.focus_best-551"><a href="#Lumascope.focus_best-551"><span class="linenos">551</span></a>            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>INTEGRATED SCOPE FUNCTIONS
select best focus position for autofocus function
(not yet ported from LVP)</p>
</div>


                            </div>
                </section>
    </main>
</body>
</html>
