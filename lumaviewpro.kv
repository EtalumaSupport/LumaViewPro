#: import GLShaderLexer pygments.lexers.GLShaderLexer

# -----------------------
# MAIN DISPLAY
# -----------------------
<MainDisplay>:
    id: main_display
    tab_pos: 'top_mid'
    tab_width: (self.size[0] / 5) - 1
    do_default_tab: False

    canvas:
        Color:
            rgba: (.188, .188, .188, 1)
        Rectangle:
            size: self.size
            pos: self.pos

    TabbedPanelItem:
        id: config_tab
        text: 'Configuration'
        ConfigTab:

    TabbedPanelItem:
        id: image_tab
        text: 'Live Image'
        ImageTab:

    TabbedPanelItem:
        id: motion_tab
        text: 'Motion'
        MotionTab:

    TabbedPanelItem:
        id: protocol_tab
        text: 'Protocol'
        ProtocolTab:

    TabbedPanelItem:
        id: analysis_tab
        text: 'Analysis'
        AnalysisTab:

# --------------------------------------------
# Microscope Configuration Layout
# --------------------------------------------
<ConfigTab>:
    orientation: 'vertical'
    Label:
        text: 'Microscope Configfuration'

# --------------------------------------------
# IImage Settings and Adjustment Layout
# --------------------------------------------
<ImageTab>:

    Splitter:
        size_hint_x: 0.2
        sizable_from: 'right'
        strip_size: 8
        ShaderEditor:
            viewer: viewer_id
    ShaderViewer:
        id: viewer_id
        size_hint_x: 0.6
        # full / fit / zoom
    Splitter:
        sizable_from: 'left'
        size_hint_x: 0.2
        strip_size: 8
        min_size: 0
        ShaderSettings:
            id: shadersettings_id

# ShaderEditor - view and edit shader code
# ------------------------------------------
<ShaderEditor>:
    orientation: 'vertical'
    # Fragment Shader Editor
    Label:
        text: 'Fragment Shader'
        size_hint_y: None
        height: self.texture_size[1] + 10
    Splitter:
        sizable_from: 'bottom'
        size_hint_y: 0.5
        strip_size: 8
        CodeInput:
            text: root.fs
            lexer: GLShaderLexer()
            on_text: root.fs = args[1]

    # Vertex Shader Editor
    Label:
        text: 'Vertex Shader'
        size_hint_y: None
        height: self.texture_size[1] + 10
    CodeInput:
        text: root.vs
        lexer: GLShaderLexer()
        on_text: root.vs = args[1]

# ShaderViewer - Shaded Live Camera view
# ------------------------------------------
<ShaderViewer>:
    orientation: 'vertical'
    # # ShaderViewer Camera
    # Camera:
    #     id: microscope_camera
    #     play: True
    #     index: 0
    #     resolution: (1920, 1080)
    #     allow_stretch: True
    #     keep_ratio: True
    Image:
        id: microscope_camera
        source: './data/composite.tif'
        allow_stretch: True
        keep_ratio: True

    # ShaderViewer Buttons
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: 0.1
        spacing: 5
        padding: 5
        ToggleButton:
            text: 'Play'
            state: 'normal'
            on_press: microscope_camera.play = not microscope_camera.play
        Button:
            text: 'Capture'
            on_press: root.capture()

# ShaderSettings - Widgets to control Shader Settings
<ShaderSettings>:
    orientation: 'vertical'
    spacing: 5
    padding: 5
    # canvas:
    #     Color:
    #         rgba: 0,0,0,1
    #     Rectangle:
    #         size: self.size
    #         pos: self.pos

    # -----------------------
    # BRIGHTFIELD Settings
    # -----------------------
    LED_Control:
        id: bf_led_id
        size_hint: 1, 0.25
        bg_color: 1, 1, 1, .3

    # BLUE lED Settings
    LED_Control:
        id: bl_led_id
        size_hint: 1, 0.25
        bg_color: 0, .5, 1, .3

    # GREEN lED Settings
    LED_Control:
        id: gr_led_id
        size_hint: 1, 0.25
        bg_color: .2, 1, 0.2, .3

    # RED lED Settings
    LED_Control:
        id: rd_led_id
        size_hint: 1, 0.25
        bg_color: 1, 0.2, 0, 1

<LED_Control>:
    # bg_color: self.bg_color
    orientation: 'vertical'
    canvas:
        Color:
            rgba: self.bg_color
        Rectangle:
            size: self.size
            pos: self.pos
    Label:
        text: 'Illumination'
        text_size: self.size
        halign: 'center'
        valign: 'middle'
    BoxLayout:
        orientation: 'horizontal'
        padding: 5, 5
        Slider:
            id: illumination_id
            min: 0
            max: 100
            value: 0
            on_value: root.parent.get_sliders()
        TextInput:
            text: '0'
            size_hint_x: 0.2
    Label:
        text: 'Gain'
        text_size: self.size
        halign: 'center'
        valign: 'middle'
    BoxLayout:
        orientation: 'horizontal'
        padding: 5, 5
        Slider:
            id: gain_id
            min: 0
            max: 100
            value: 100
            on_value: root.parent.get_sliders()
        TextInput:
            text: '0'
            size_hint_x: 0.2
    Label:
        text: 'Exposure'
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        # color: 1, 0.2, 0, 1
    BoxLayout:
        orientation: 'horizontal'
        padding: 5, 5
        Slider:
            id: exposure_id
            min: 100
            max: 200
            value: 150
            on_value: root.parent.get_sliders()
        TextInput:
            text: '0'
            size_hint_x: 0.2

# --------------------------------------------
# Microscope Motion Layout
# --------------------------------------------
<MotionTab>:
    Label:
        text: 'Control microscope motion'

# --------------------------------------------
# Protocol Layout
# --------------------------------------------
<ProtocolTab>:
    GridLayout:
        cols: 7
        padding: 10
        spacing: 10
        row_default_height: 40

        # PROTOCOL - LABELS
        Label:
            text: ''
        Label:
            text: 'Folder'
        # Widget:
        #     Scatter:
        #         center: self.parent.center
        #         size: text.size
        #         do_rotation: False
        #         do_translation: False
        #         do_scale: False
        #         rotation: 90
        #         Label:
        #             id: text
        #             size: self.texture_size
        #             text: "Folder"
        Label:
            text: 'Filename Root'
        # Widget:
        #     Scatter:
        #         center: self.parent.center
        #         size: text.size
        #         do_rotation: False
        #         do_translation: False
        #         do_scale: False
        #         rotation: 90
        #         Label:
        #             id: text
        #             size: self.texture_size
        #             text: "Filename Root"
        Widget:
            size_hint_x: None
            width: 40
            Scatter:
                center: self.parent.center
                size: text.size
                do_rotation: False
                do_translation: False
                do_scale: False
                rotation: 90
                Label:
                    id: text
                    size: self.texture_size
                    text: "Illumination"
        Widget:
            size_hint_x: None
            width: 40
            Scatter:
                center: self.parent.center
                size: text.size
                do_rotation: False
                do_translation: False
                do_scale: False
                rotation: 90
                Label:
                    id: text
                    size: self.texture_size
                    text: "Gain"
        Widget:
            size_hint_x: None
            width: 40
            Scatter:
                center: self.parent.center
                size: text.size
                do_rotation: False
                do_translation: False
                do_scale: False
                rotation: 90
                Label:
                    id: text
                    size: self.texture_size
                    text: "Exposure"
        Widget:
            size_hint_x: None
            width: 40
            Scatter:
                center: self.parent.center
                size: text.size
                do_rotation: False
                do_translation: False
                do_scale: False
                rotation: 90
                Label:
                    id: text
                    size: self.texture_size
                    text: "Acquire"

        # PROTOCOL - BRIGHTFIELD
        Label:
            canvas:
                Color:
                    rgba: 1, 1, 1, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Brightfield'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

        # PROTOCOL - BLUE
        Label:
            canvas:
                Color:
                    rgba: 0, .5, 1, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Blue Channel'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

        # PROTOCOL - GREEN
        Label:
            canvas:
                Color:
                    rgba: .2, 1, 0.2, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Green Channel'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

        # PROTOCOL - RED
        Label:
            canvas:
                Color:
                    rgba: 1, .2, .2, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Red Channel'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

        # PROTOCOL - COMPOSITE
        Label:
            canvas:
                Color:
                    rgba: 1, 1, 1, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Composite Image'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

# --------------------------------------------
# Analysis Layout
# --------------------------------------------
<AnalysisTab>:
    Label:
        text: 'Perform image stack analysis'
