#: import GLShaderLexer pygments.lexers.GLShaderLexer

# -----------------------
# MAIN DISPLAY
# -----------------------
<MainDisplay>:
    id: main_display
    tab_pos: 'top_mid'
    tab_width: (self.size[0] / 5) - 1
    do_default_tab: False

    canvas:
        Color:
            rgba: (.188, .188, .188, 1)
        Rectangle:
            size: self.size
            pos: self.pos

    TabbedPanelItem:
        id: config_tab
        text: 'Configuration'
        ConfigTab:

    TabbedPanelItem:
        id: image_tab
        text: 'Live Image'
        ImageTab:

    TabbedPanelItem:
        id: motion_tab
        text: 'Motion'
        MotionTab:

    TabbedPanelItem:
        id: protocol_tab
        text: 'Protocol'
        ProtocolTab:

    TabbedPanelItem:
        id: analysis_tab
        text: 'Analysis'
        AnalysisTab:

# --------------------------------------------
# Microscope Configuration Layout
# --------------------------------------------
<ConfigTab>:
    orientation: 'vertical'
    Label:
        text: 'Microscope Configfuration'

# --------------------------------------------
# IImage Settings and Adjustment Layout
# --------------------------------------------
<ImageTab>:

    Splitter:
        size_hint_x: 0.2
        sizable_from: 'right'
        strip_size: 8
        ShaderEditor:
            viewer: viewer_id
    ShaderViewer:
        id: viewer_id
        size_hint_x: 0.6
        # full / fit / zoom
    Splitter:
        sizable_from: 'left'
        size_hint_x: 0.2
        strip_size: 8
        min_size: 0
        ShaderSettings:
            id: shadersettings_id

# ShaderEditor - view and edit shader code
# ------------------------------------------
<ShaderEditor>:
    orientation: 'vertical'
    # Fragment Shader Editor
    Label:
        text: 'Fragment Shader'
        size_hint_y: None
        height: self.texture_size[1] + 10
    Splitter:
        sizable_from: 'bottom'
        size_hint_y: 0.5
        strip_size: 8
        CodeInput:
            text: root.fs
            lexer: GLShaderLexer()
            on_text: root.fs = args[1]

    # Vertex Shader Editor
    Label:
        text: 'Vertex Shader'
        size_hint_y: None
        height: self.texture_size[1] + 10
    CodeInput:
        text: root.vs
        lexer: GLShaderLexer()
        on_text: root.vs = args[1]

# ShaderViewer - Shaded Live Camera view
# ------------------------------------------
<ShaderViewer>:
    orientation: 'vertical'

    # # ShaderViewer Camera
    # Camera:
    #     id: microscope_camera
    #     play: True
    #     index: 0
    #     resolution: (1920, 1080)
    #     allow_stretch: True
    #     keep_ratio: True
    Image:
        id: microscope_camera
        source: './data/composite.tif'
        allow_stretch: True
        keep_ratio: True

    # ShaderViewer Buttons
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: 0.1
        spacing: 5
        padding: 5
        ToggleButton:
            text: 'Play'
            state: 'normal'
            on_press: microscope_camera.play = not microscope_camera.play
        Button:
            text: 'Capture'
            on_press: root.capture()

# ShaderSettings - Widgets to control Shader Settings
<ShaderSettings>:
    orientation: 'vertical'
    spacing: 15
    padding: 15
    canvas:
        Color:
            rgba: 0, 0, 0, 0.5
        Rectangle:
            size: self.size
            pos: self.pos

    # -----------------------
    # BRIGHTFIELD Settings
    # -----------------------
    LED_Control:
        id: bf_led_id
        ctrl_label: 'Brightfield'
        size_hint: 1, 0.25
        bg_color: 0.5, 0.5, 0.5, 1

    # BLUE lED Settings
    LED_Control:
        id: bl_led_id
        ctrl_label: 'Blue LED'
        size_hint: 1, 0.25
        bg_color: 0, .5, 1, 1

    # GREEN lED Settings
    LED_Control:
        id: gr_led_id
        ctrl_label: 'Green LED'
        size_hint: 1, 0.25
        bg_color: .2, 0.8, 0.2, 1

    # RED lED Settings
    LED_Control:
        id: rd_led_id
        ctrl_label: 'Red LED'
        size_hint: 1, 0.25
        bg_color: 1, 0.2, 0, 1

<LED_Control>:
    padding: 15
    spacing: 15
    orientation: 'vertical'
    canvas:
        Color:
            rgba: 0, 0, 0, 0.5
        Rectangle:
            size: self.size
            pos: self.pos

    # BoxLayout:
    #     Label:
    #         text: root.ctrl_label
    #         text_size: self.size
    #         halign: 'center'
    #         valign: 'middle'
    #     Switch:
    #         active: True

    # Illumination
    BoxLayout:

        orientation: 'vertical'
        Label:
            text: root.ctrl_label
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: 'Illumination'
                halign: 'center'
                valign: 'middle'

            TextInput:
                size_hint_x: 0.3
                multiline: False
                font_size: self.height/4
                padding: [10, (self.height-self.line_height)/2]
                halign: 'center'
                background_color: 0.6, 0.6, 0.6, 1
                input_filter: 'float'
                text:  str(int(illumination_id.value))

            Slider:
                id: illumination_id
                min: 0
                max: 100
                value: 0
                cursor_size: 20,20
                value_track: True
                value_track_color: root.bg_color
                on_value: root.parent.get_sliders()

        # Gain
        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: 'Gain'
                halign: 'center'
                valign: 'middle'
                padding: 5, 5
            TextInput:
                size_hint_x: 0.3
                multiline: False
                font_size: self.height/4
                padding: [10, (self.height-self.line_height)/2]
                halign: 'center'
                background_color: 0.6, 0.6, 0.6, 1
                input_filter: 'float'
                text:  str(int(gain_id.value))
                spacing: 15, 15
            Slider:
                id: gain_id
                min: 0
                max: 100
                value: 100
                cursor_size: 20,20
                value_track: True
                value_track_color: root.bg_color
                on_value: root.parent.get_sliders()

        # Exposure
        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: 'Exposure'
                halign: 'center'
                valign: 'middle'
                padding: 5, 5
            TextInput:
                size_hint_x: 0.3
                multiline: False
                font_size: self.height/4
                padding: [10, (self.height-self.line_height)/2]
                halign: 'center'
                background_color: 0.6, 0.6, 0.6, 1
                input_filter: 'float'
                text:  str(int(exposure_id.value))
            Slider:
                id: exposure_id
                min: 100
                max: 200
                value: 150
                cursor_size: 20,20
                value_track: True
                value_track_color: root.bg_color
                on_value: root.parent.get_sliders()

# --------------------------------------------
# Microscope Motion Layout
# --------------------------------------------
<MotionTab>:
    Label:
        text: 'Control microscope motion'

# --------------------------------------------
# Protocol Layout
# --------------------------------------------
<ProtocolTab>:
    orientation: 'vertical'
    padding: 5
    spacing: 5
    # row_default_height: 40

    BoxLayout:

    GridLayout:
        cols: 3
        spacing: 5
        size_hint_y: None
        height: 80
        Label:
            text: 'Capture Rate'
        TextInput:
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
            halign: 'right'
            input_filter: 'int'
            # text:  str(int(illumination_id.value))
            text: '5'
        Label:
            text: 'minutes'

        Label:
            text: 'Capture Duration'
        TextInput:
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
            halign: 'right'
            input_filter: 'int'
            # text:  str(int(illumination_id.value))
            text: '48'
        Label:
            text: 'hours'

    BoxLayout:
        spacing: 5
        size_hint_y: None
        height: 20

    BoxLayout:
        spacing: 5
        size_hint_y: None
        height: 40
        orientation: 'horizontal'
        # PROTOCOL - LABELS
        Label:
            text: ''
            size_hint_x: None
            width: 100
        Label:
            text: 'Folder'
        Label:
            text: 'Filename Root'
        Label:
            text: 'Ill.'
            size_hint_x: None
            width: 40
        Label:
            text: 'Gain'
            size_hint_x: None
            width: 40
        Label:
            text: 'Exp.'
            size_hint_x: None
            width: 40
        Label:
            text: 'Acq.'
            size_hint_x: None
            width: 40

    Protocol_Control:
        id: bf_protocol
        protocol_label: 'Brightfield'
        bg_color: 1, 1, 1, 0.2
    Protocol_Control:
        id: bf_protocol
        protocol_label: 'Blue'
        bg_color: 0, 0.2, 1, 0.2
    Protocol_Control:
        id: bf_protocol
        protocol_label: 'Green'
        bg_color: 0.2, 1, 0.2, 0.2
    Protocol_Control:
        id: bf_protocol
        protocol_label: 'Red'
        bg_color: 1, 0.2, 0, 0.2
    Protocol_Control:
        id: bf_protocol
        protocol_label: 'Composite'
        bg_color: 1, 1, 1, 0.2

    BoxLayout:

    BoxLayout:
        spacing: 5
        size_hint_y: None
        height: 40
        orientation: 'horizontal'
        # PROTOCOL - LABELS
        Button:
            text: 'Import from Live Image'
        Button:
            text: 'Load Protocol'
        Button:
            text: 'Save Protocol'


<Protocol_Control>:
    spacing: 5
    size_hint_y: None
    height: 40
    Label:
        size_hint_x: None
        width: 100
        canvas:
            Color:
                rgba: root.bg_color
            Rectangle:
                size: self.size
                pos: self.pos
        text: root.protocol_label
    TextInput:
        suggestion_text: 'folder'
        multiline: False
        padding: [10, (self.height-self.line_height)/2]
    TextInput:
        suggestion_text: 'filename root'
        multiline: False
        padding: [10, (self.height-self.line_height)/2]
    TextInput:
        suggestion_text: '100'
        size_hint_x: None
        width: 40
        multiline: False
        padding: [10, (self.height-self.line_height)/2]
    TextInput:
        suggestion_text: '100'
        size_hint_x: None
        width: 40
        multiline: False
        padding: [10, (self.height-self.line_height)/2]
    TextInput:
        suggestion_text: '150'
        size_hint_x: None
        width: 40
        multiline: False
        padding: [10, (self.height-self.line_height)/2]
    CheckBox:
        size_hint_x: None
        width: 40

# --------------------------------------------
# Analysis Layout
# --------------------------------------------
<AnalysisTab>:
    Label:
        text: 'Perform image stack analysis'
