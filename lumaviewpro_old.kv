#:kivy 1.0
#: import GLShaderLexer pygments.lexers.GLShaderLexer

<ShaderEditor>:
    viewer: viewer_id
    orientation: 'horizontal'

    # code editing section

    BoxLayout:
        orientation: 'vertical'
        size_hint_x: .2
        #width: 350

        Label:
            text: 'Fragment Shader'
            size_hint_y: None
            height: self.texture_size[1] + 10
        CodeInput:
            text: root.fs
            lexer: GLShaderLexer()
            on_text: root.fs = args[1]

        Label:
            text: 'Vertex Shader'
            size_hint_y: None
            height: self.texture_size[1] + 10
        CodeInput:
            text: root.vs
            lexer: GLShaderLexer()
            on_text: root.vs = args[1]

    # viewer and camera control buttons section
    FloatLayout:
        size_hint: 0.8, 1
        ShaderViewer:
            id: viewer_id
            size_hint: 1, 1
            pos_hint: {"x":0, "y":0}
            # Camera:
            #     id: scope
            #     play: True
            #     index: 0
            #     resolution: (1920, 1080)
            Image:
                id: scope
                source: './data/composite.tif'

        ToggleButton:
            size_hint: 0.375, 0.1
            pos_hint: {"x":0, "y":0.0}
            text: 'Play'
            state: 'down'
            on_press: scope.play = not scope.play
        Button:
            size_hint: 0.375, 0.1
            pos_hint: {"x":0.375, "y":0.0}
            text: 'Capture'
            on_press: root.capture()


        # sliders section
        BoxLayout:
            size_hint: 0.25, 1
            pos_hint: {"x":0.75, "y":0}
            orientation: 'vertical'
            padding: 0
            # canvas:
            #     Color:
            #         rgba: 1, 1, 1, .2
            #     Rectangle:
            #         size: self.size
            #         pos: self.pos

            # -----------------------
            # BRIGHTFIELD Settings
            # -----------------------
            BoxLayout:
                size_hint: 1, 0.25
                orientation: 'vertical'
                padding: 5,5
                canvas:
                    Color:
                        rgba: 1, 1, 1, .3
                    Rectangle:
                        size: self.size
                        pos: self.pos
                # Label:
                #     text: 'Bright Field'
                #     text_size: self.size
                #     halign: 'center'
                #     valign: 'middle'
                #     outline_color: 0.5, 0.5, 0.5
                #     outline_width: 2
                Label:
                    text: 'Illumination'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                BoxLayout:
                    orientation: 'horizontal'
                    padding: 5, 5
                    Slider:
                        id: bf_ill
                        min: 0
                        max: 100
                        value: 0
                        on_value: root.get_sliders()
                    TextInput:
                        text: '0'
                        size_hint_x: 0.2
                Label:
                    text: 'Gain'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                BoxLayout:
                    orientation: 'horizontal'
                    padding: 5, 5
                    Slider:
                        id: bf_gain
                        min: 0
                        max: 100
                        value: 100
                        on_value: root.get_sliders()
                    TextInput:
                        text: '100'
                        size_hint_x: 0.2
                Label:
                    text: 'Exposure'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                BoxLayout:
                    orientation: 'horizontal'
                    padding: 5, 5
                    Slider:
                        id: bf_exp
                        min: 100
                        max: 200
                        value: 150
                        on_value: root.get_sliders()
                    TextInput:
                        text: '150'
                        size_hint_x: 0.2

            # -----------------------
            # BLUE lED Settings
            # -----------------------
            BoxLayout:
                size_hint: 1, 0.25
                orientation: 'vertical'
                padding: 10
                canvas:
                    Color:
                        rgba: 0, .5, 1, .3
                    Rectangle:
                        size: self.size
                        pos: self.pos
                # Label:
                #     text: 'Blue'
                #     text_size: self.size
                #     halign: 'center'
                #     valign: 'middle'
                #     outline_color: 0.2, 0.5, 1
                #     outline_width: 1
                Label:
                    text: 'Illumination'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 0.2,0.5,1,1
                Slider:
                    id: bl_ill
                    min: 0
                    max: 100
                    value: 0
                    on_value: root.get_sliders()
                Label:
                    text: 'Gain'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 0.2,0.5,1,1
                Slider:
                    id: bl_gain
                    min: 0
                    max: 100
                    value: 100
                    on_value: root.get_sliders()
                Label:
                    text: 'Exposure'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 0.2,0.5,1,1
                Slider:
                    id: bl_exp
                    min: 100
                    max: 200
                    value: 150
                    on_value: root.get_sliders()

            # -----------------------
            # GREEN lED Settings
            # -----------------------
            BoxLayout:
                size_hint: 1, 0.25
                orientation: 'vertical'
                padding: 10
                canvas:
                    Color:
                        rgba: .2, 1, 0.2, .3
                    Rectangle:
                        size: self.size
                        pos: self.pos
                # Label:
                #     text: 'Green'
                #     text_size: self.size
                #     halign: 'center'
                #     valign: 'middle'
                #     outline_color: 0,0.8,0
                #     outline_width: 1
                Label:
                    text: 'Illumination'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 0.2,1, 0.2, 1
                Slider:
                    id: gr_ill
                    min: 0
                    max: 100
                    value: 0
                    on_value: root.get_sliders()
                Label:
                    text: 'Gain'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 0.2,1, 0.2, 1
                Slider:
                    id: gr_gain
                    min: 0
                    max: 100
                    value: 100
                    on_value: root.get_sliders()
                Label:
                    text: 'Exposure'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 0.2,1, 0.2, 1
                Slider:
                    id: gr_exp
                    min: 100
                    max: 200
                    value:150
                    on_value: root.get_sliders()

            # -----------------------
            # RED lED Settings
            # -----------------------
            BoxLayout:
                size_hint: 1, 0.25
                orientation: 'vertical'
                padding: 10
                canvas:
                    Color:
                        rgba: 1, .2, .2, .3
                    Rectangle:
                        size: self.size
                        pos: self.pos
                # Label:
                #     text: 'Red'
                #     text_size: self.size
                #     halign: 'center'
                #     valign: 'middle'
                #     outline_color: 0.8,0,0
                #     outline_width: 1
                Label:
                    text: 'Illumination'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 1, 0.2, 0, 1
                Slider:
                    id: rd_ill
                    min: 0
                    max: 100
                    value: 0
                    on_value: root.get_sliders()
                Label:
                    text: 'Gain'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 1, 0.2, 0, 1
                Slider:
                    id: rd_gain
                    min: 0
                    max: 100
                    value: 100
                    on_value: root.get_sliders()
                Label:
                    text: 'Exposure'
                    text_size: self.size
                    halign: 'center'
                    valign: 'middle'
                    # color: 1, 0.2, 0, 1
                Slider:
                    id: rd_exp
                    min: 100
                    max: 200
                    value: 150
                    on_value: root.get_sliders()

# -----------------------
# MAIN DISPLAY
# -----------------------
<MainDisplay>:
    id: main_display
    tab_pos: 'top_mid'
    tab_width: (self.size[0] / 5) - 1
    do_default_tab: False
    canvas:
        Color:
            rgba: (.188, .188, .188, 1)
        Rectangle:
            size: self.size
            pos: self.pos

    TabbedPanelItem:
        id: config_tab
        text: 'Configuration'
        ConfigTab:

    TabbedPanelItem:
        id: image_tab
        text: 'Live Image'
        ImageTab:

    TabbedPanelItem:
        id: motion_tab
        text: 'Motion'
        MotionTab:

    TabbedPanelItem:
        id: protocol_tab
        text: 'Protocol'
        ProtocolTab:

    TabbedPanelItem:
        id: analysis_tab
        text: 'Analysis'
        AnalysisTab:

# --------------------------------------------
# Microscope Configuration Layout
# --------------------------------------------
<ConfigTab>:
    orientation: 'vertical'
    GridLayout:
        cols: 4
        CheckBox:
            active: False
        CheckBox:
            active: False
        CheckBox:
            active: False
        CheckBox:
            active: False
        Label:
            text: 'LS460'
        Label:
            text: 'LS560'
        Label:
            text: 'LS620'
        Label:
            text: 'LS720'
        Image:
            source: './data/460.png'
        Image:
            source: './data/560.png'
        Image:
            source: './data/620.png'
        Image:
            source: './data/720.png'

# --------------------------------------------
# Image Settings and Adjustment Layout
# --------------------------------------------
<ImageTab>:
    ShaderEditor:

# --------------------------------------------
# Microscope Motion Layout
# --------------------------------------------
<MotionTab>:
    Label:
        text: 'Control microscope motion'

# --------------------------------------------
# Protocol Layout
# --------------------------------------------
<ProtocolTab>:
    GridLayout:
        cols: 7
        padding: 10
        spacing: 10
        row_default_height: 40

        # PROTOCOL - LABELS
        Label:
            text: ''
        Label:
            text: 'Folder'
        # Widget:
        #     Scatter:
        #         center: self.parent.center
        #         size: text.size
        #         do_rotation: False
        #         do_translation: False
        #         do_scale: False
        #         rotation: 90
        #         Label:
        #             id: text
        #             size: self.texture_size
        #             text: "Folder"
        Label:
            text: 'Filename Root'
        # Widget:
        #     Scatter:
        #         center: self.parent.center
        #         size: text.size
        #         do_rotation: False
        #         do_translation: False
        #         do_scale: False
        #         rotation: 90
        #         Label:
        #             id: text
        #             size: self.texture_size
        #             text: "Filename Root"
        Widget:
            size_hint_x: None
            width: 40
            Scatter:
                center: self.parent.center
                size: text.size
                do_rotation: False
                do_translation: False
                do_scale: False
                rotation: 90
                Label:
                    id: text
                    size: self.texture_size
                    text: "Illumination"
        Widget:
            size_hint_x: None
            width: 40
            Scatter:
                center: self.parent.center
                size: text.size
                do_rotation: False
                do_translation: False
                do_scale: False
                rotation: 90
                Label:
                    id: text
                    size: self.texture_size
                    text: "Gain"
        Widget:
            size_hint_x: None
            width: 40
            Scatter:
                center: self.parent.center
                size: text.size
                do_rotation: False
                do_translation: False
                do_scale: False
                rotation: 90
                Label:
                    id: text
                    size: self.texture_size
                    text: "Exposure"
        Widget:
            size_hint_x: None
            width: 40
            Scatter:
                center: self.parent.center
                size: text.size
                do_rotation: False
                do_translation: False
                do_scale: False
                rotation: 90
                Label:
                    id: text
                    size: self.texture_size
                    text: "Acquire"

        # PROTOCOL - BRIGHTFIELD
        Label:
            canvas:
                Color:
                    rgba: 1, 1, 1, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Brightfield'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

        # PROTOCOL - BLUE
        Label:
            canvas:
                Color:
                    rgba: 0, .5, 1, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Blue Channel'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

        # PROTOCOL - GREEN
        Label:
            canvas:
                Color:
                    rgba: .2, 1, 0.2, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Green Channel'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

        # PROTOCOL - RED
        Label:
            canvas:
                Color:
                    rgba: 1, .2, .2, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Red Channel'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

        # PROTOCOL - COMPOSITE
        Label:
            canvas:
                Color:
                    rgba: 1, 1, 1, .3
                Rectangle:
                    size: self.size
                    pos: self.pos
            text: 'Composite Image'
        TextInput:
            suggestion_text: 'folder'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: 'filename root'
            multiline: False
            padding: [10, (self.height-self.line_height)/2]
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '100'
            size_hint_x: None
            width: 40
        TextInput:
            suggestion_text: '150'
            size_hint_x: None
            width: 40
        CheckBox:
            size_hint_x: None
            width: 40

# --------------------------------------------
# Analysis Layout
# --------------------------------------------
<AnalysisTab>:
    Label:
        text: 'Perform image stack analysis'
